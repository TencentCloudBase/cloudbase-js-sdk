!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("cloudbase_auth",[],t):"object"==typeof exports?exports.cloudbase_auth=t():e.cloudbase_auth=t()}("undefined"!=typeof window?window:this,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.jwt=t.helpers=t.utils=t.events=t.cache=t.adapters=t.constants=void 0;var c=i(n(3));t.constants=c;var a=i(n(8));t.adapters=a;var u=i(n(15));t.cache=u;var h=i(n(17));t.events=h;var l=i(n(1));t.utils=l;var f=i(n(18));t.helpers=f;var p={decode:s(n(20)).default};t.jwt=p},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.transformPhone=t.sleep=t.printGroupLog=t.throwError=t.printInfo=t.printError=t.printWarn=t.execCallback=t.createPromiseCallback=t.removeParam=t.getHash=t.getQuery=t.toQueryString=t.createSign=t.formatUrl=t.genSeqId=t.isFormData=t.isInstanceOf=t.isNull=t.isPalinObject=t.isUndefined=t.isString=t.isArray=void 0;var o=r(n(10)),i=r(n(13)),s=r(n(14)),c=n(3);function a(e){var t=i.default.stringify(e);return t=(t=(t=t.replace(/=+$/,"")).replace(/\+/g,"-")).replace(/\//g,"_")}t.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},t.isString=function(e){return"string"==typeof e},t.isUndefined=function(e){return void 0===e},t.isPalinObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},t.isNull=function(e){return"[object Null]"===Object.prototype.toString.call(e)},t.isInstanceOf=function(e,t){return e instanceof t},t.isFormData=function(e){return"[object FormData]"===Object.prototype.toString.call(e)},t.genSeqId=function(){return Math.random().toString(16).slice(2)},t.formatUrl=function(e,t,n){void 0===n&&(n={});var r=/\?/.test(t),o="";for(var i in n)""===o?!r&&(t+="?"):o+="&",o+=i+"="+encodeURIComponent(n[i]);return/^http(s)?\:\/\//.test(t+=o)?t:""+e+t},t.createSign=function(e,t){var n=a(s.default.parse(JSON.stringify({alg:"HS256",typ:"JWT"})))+"."+a(s.default.parse(JSON.stringify(e)));return n+"."+a(o.default(n,t))},t.toQueryString=function(e){void 0===e&&(e={});var t=[];for(var n in e)t.push(n+"="+encodeURIComponent(e[n]));return t.join("&")},t.getQuery=function(e,t){if("undefined"==typeof window)return!1;var n=t||window.location.search,r=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),o=n.substr(n.indexOf("?")+1).match(r);return null!=o?o[2]:""},t.getHash=function(e){if("undefined"==typeof window)return"";var t=window.location.hash.match(new RegExp("[#?&/]"+e+"=([^&#]*)"));return t?t[1]:""},t.removeParam=function(e,t){var n=t.split("?")[0],r=[],o=-1!==t.indexOf("?")?t.split("?")[1]:"";if(""!==o){for(var i=(r=o.split("&")).length-1;i>=0;i-=1)r[i].split("=")[0]===e&&r.splice(i,1);n=n+"?"+r.join("&")}return n},t.createPromiseCallback=function(){var e;if(!Promise){(e=function(){}).promise={};var t=function(){throw new Error('Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.')};return Object.defineProperty(e.promise,"then",{get:t}),Object.defineProperty(e.promise,"catch",{get:t}),e}var n=new Promise((function(t,n){e=function(e,r){return e?n(e):t(r)}}));return e.promise=n,e},t.execCallback=function(e,t,n){if(void 0===n&&(n=null),e&&"function"==typeof e)return e(t,n);if(t)throw t;return n},t.printWarn=function(e,t){console.warn("["+c.getSdkName()+"]["+e+"]:"+t)},t.printError=function(e,t){console.error({code:e,msg:"["+c.getSdkName()+"]["+e+"]:"+t})},t.printInfo=function(e,t){console.log("["+c.getSdkName()+"]["+e+"]:"+t)},t.throwError=function(e,t){throw new Error(JSON.stringify({code:e,msg:"["+c.getSdkName()+"]["+e+"]:"+t}))},t.printGroupLog=function(e){var t=e.title,n=e.subtitle,r=void 0===n?"":n,o=e.content,i=void 0===o?[]:o,s=e.printTrace,c=void 0!==s&&s,a=e.collapsed;void 0!==a&&a?console.groupCollapsed(t,r):console.group(t,r);for(var u=0,h=i;u<h.length;u++){var l=h[u],f=l.type,p=l.body;switch(f){case"info":console.log(p);break;case"warn":console.warn(p);break;case"error":console.error(p)}}c&&console.trace("stack trace:"),console.groupEnd()},t.sleep=function(e){return void 0===e&&(e=0),new Promise((function(t){return setTimeout(t,e)}))},t.transformPhone=function(e){return"+86"+e}},function(e,t,n){var r;e.exports=(r=r||function(e,t){var n=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),r={},o=r.lib={},i=o.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=o.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,o=e.sigBytes;if(this.clamp(),r%4)for(var i=0;i<o;i++){var s=n[i>>>2]>>>24-i%4*8&255;t[r+i>>>2]|=s<<24-(r+i)%4*8}else for(i=0;i<o;i+=4)t[r+i>>>2]=n[i>>>2];return this.sigBytes+=o,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n,r=[],o=function(t){t=t;var n=987654321,r=4294967295;return function(){var o=((n=36969*(65535&n)+(n>>16)&r)<<16)+(t=18e3*(65535&t)+(t>>16)&r)&r;return o/=4294967296,(o+=.5)*(e.random()>.5?1:-1)}},i=0;i<t;i+=4){var c=o(4294967296*(n||e.random()));n=987654071*c(),r.push(4294967296*c()|0)}return new s.init(r,t)}}),c=r.enc={},a=c.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o++){var i=t[o>>>2]>>>24-o%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new s.init(n,t/2)}},u=c.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o++){var i=t[o>>>2]>>>24-o%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new s.init(n,t)}},h=c.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},l=o.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,o=n.sigBytes,i=this.blockSize,c=o/(4*i),a=(c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0))*i,u=e.min(4*a,o);if(a){for(var h=0;h<a;h+=i)this._doProcessBlock(r,h);var l=r.splice(0,a);n.sigBytes-=u}return new s.init(l,u)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),f=(o.Hasher=l.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new f.HMAC.init(e,n).finalize(t)}}}),r.algo={});return r}(Math),r)},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.OATUH_LOGINTYPE=void 0,o(n(4),t),o(n(7),t),t.OATUH_LOGINTYPE="constants"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COMMUNITY_SITE_URL=t.IS_DEBUG_MODE=t.getProtocol=t.setProtocol=t.getSdkName=t.setSdkName=void 0;var r="@cloudbase/js-sdk";t.setSdkName=function(e){r=e},t.getSdkName=function(){return r};var o="undefined"!=typeof location&&"http:"===location.protocol?"http:":"https:";t.setProtocol=function(e){o=e},t.getProtocol=function(){return o},t.IS_DEBUG_MODE=!1,t.COMMUNITY_SITE_URL="https://support.qq.com/products/148793"},function(e,t,n){"use strict";var r;n.r(t),n.d(t,"StorageType",(function(){return r})),n.d(t,"AbstractSDKRequest",(function(){return o})),n.d(t,"AbstractStorage",(function(){return i})),n.d(t,"formatUrl",(function(){return s})),function(e){e.local="local",e.none="none",e.session="session"}(r||(r={}));var o=function(){},i=function(){};function s(e,t,n){void 0===n&&(n={});var r=/\?/.test(t),o="";for(var i in n)""===o?!r&&(t+="?"):o+="&",o+=i+"="+encodeURIComponent(n[i]);return/^http(s)?\:\/\//.test(t+=o)?t:""+e+t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.registerProvider=t.registerAuth=void 0;var r=n(21);t.registerAuth=r.registerAuth,t.registerProvider=r.registerProvider},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ERRORS=void 0,t.ERRORS={INVALID_PARAMS:"INVALID_PARAMS",INVALID_SYNTAX:"INVALID_SYNTAX",INVALID_OPERATION:"INVALID_OPERATION",OPERATION_FAIL:"OPERATION_FAIL",NETWORK_ERROR:"NETWORK_ERROR",UNKOWN_ERROR:"UNKOWN_ERROR"}},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.useDefaultAdapter=t.useAdapters=t.RUNTIME=void 0;var s,c=i(n(9)),a=n(1);!function(e){e.WEB="web",e.WX_MP="wx_mp"}(s=t.RUNTIME||(t.RUNTIME={})),t.useAdapters=function(e){for(var t=0,n=a.isArray(e)?e:[e];t<n.length;t++){var r=n[t],o=r.isMatch,i=r.genAdapter,s=r.runtime;if(o())return{adapter:i(),runtime:s}}},t.useDefaultAdapter=function(){return{adapter:c.genAdapter(),runtime:s.WEB}}},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.WebRequest=t.genAdapter=void 0;var a=n(5),u=n(1),h=n(4),l=function(e){function t(t){var n=e.call(this)||this,r=t.timeout,o=t.timeoutMsg,i=t.restrictedMethods;return n._timeout=r||0,n._timeoutMsg=o||"请求超时",n._restrictedMethods=i||["get","post","upload","download"],n}return o(t,e),t.prototype.get=function(e){return this._request(i(i({},e),{method:"get"}),this._restrictedMethods.includes("get"))},t.prototype.post=function(e){return this._request(i(i({},e),{method:"post"}),this._restrictedMethods.includes("post"))},t.prototype.put=function(e){return this._request(i(i({},e),{method:"put"}))},t.prototype.upload=function(e){var t=e.data,n=e.file,r=e.name,o=new FormData;for(var s in t)o.append(s,t[s]);return o.append("key",r),o.append("file",n),this._request(i(i({},e),{data:o,method:"post"}),this._restrictedMethods.includes("upload"))},t.prototype.download=function(e){return s(this,void 0,void 0,(function(){var t,n,r,o;return c(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this.get(i(i({},e),{headers:{},responseType:"blob"}))];case 1:return t=s.sent().data,n=window.URL.createObjectURL(new Blob([t])),r=decodeURIComponent(new URL(e.url).pathname.split("/").pop()||""),(o=document.createElement("a")).href=n,o.setAttribute("download",r),o.style.display="none",document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(n),document.body.removeChild(o),[3,3];case 2:return s.sent(),[3,3];case 3:return[2,new Promise((function(t){t({statusCode:200,tempFilePath:e.url})}))]}}))}))},t.prototype._request=function(e,t){var n=this;void 0===t&&(t=!1);var r=String(e.method).toLowerCase()||"get";return new Promise((function(o){var i,s,c=e.url,a=e.headers,l=void 0===a?{}:a,f=e.data,p=e.responseType,d=e.withCredentials,y=e.body,g=e.onUploadProgress,v=u.formatUrl(h.getProtocol(),c,"get"===r?f:{}),_=new XMLHttpRequest;for(var m in _.open(r,v),p&&(_.responseType=p),l)_.setRequestHeader(m,l[m]);g&&_.upload.addEventListener("progress",g),_.onreadystatechange=function(){var e={};if(4===_.readyState){var t=_.getAllResponseHeaders().trim().split(/[\r\n]+/),n={};t.forEach((function(e){var t=e.split(": "),r=t.shift().toLowerCase(),o=t.join(": ");n[r]=o})),e.header=n,e.statusCode=_.status;try{e.data="blob"===p?_.response:JSON.parse(_.responseText)}catch(t){e.data="blob"===p?_.response:_.responseText}clearTimeout(i),o(e)}},t&&n._timeout&&(i=setTimeout((function(){console.warn(n._timeoutMsg),_.abort()}),n._timeout)),s=u.isFormData(f)?f:"application/x-www-form-urlencoded"===l["content-type"]?u.toQueryString(f):y||(f?JSON.stringify(f):void 0),d&&(_.withCredentials=!0),_.send(s)}))},t}(a.AbstractSDKRequest);t.WebRequest=l,t.genAdapter=function(){return{root:window,reqClass:l,wsClass:WebSocket,localStorage:localStorage,sessionStorage:sessionStorage}}},function(e,t,n){var r;e.exports=(r=n(2),n(11),n(12),r.HmacSHA256)},function(e,t,n){var r;e.exports=(r=n(2),function(e){var t=r,n=t.lib,o=n.WordArray,i=n.Hasher,s=t.algo,c=[],a=[];!function(){function t(t){for(var n=e.sqrt(t),r=2;r<=n;r++)if(!(t%r))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var r=2,o=0;o<64;)t(r)&&(o<8&&(c[o]=n(e.pow(r,.5))),a[o]=n(e.pow(r,1/3)),o++),r++}();var u=[],h=s.SHA256=i.extend({_doReset:function(){this._hash=new o.init(c.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],o=n[1],i=n[2],s=n[3],c=n[4],h=n[5],l=n[6],f=n[7],p=0;p<64;p++){if(p<16)u[p]=0|e[t+p];else{var d=u[p-15],y=(d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3,g=u[p-2],v=(g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10;u[p]=y+u[p-7]+v+u[p-16]}var _=r&o^r&i^o&i,m=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),b=f+((c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25))+(c&h^~c&l)+a[p]+u[p];f=l,l=h,h=c,c=s+b|0,s=i,i=o,o=r,r=b+(m+_)|0}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+i|0,n[3]=n[3]+s|0,n[4]=n[4]+c|0,n[5]=n[5]+h|0,n[6]=n[6]+l|0,n[7]=n[7]+f|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,o=8*t.sigBytes;return n[o>>>5]|=128<<24-o%32,n[14+(o+64>>>9<<4)]=e.floor(r/4294967296),n[15+(o+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=i._createHelper(h),t.HmacSHA256=i._createHmacHelper(h)}(Math),r.SHA256)},function(e,t,n){var r,o,i,s;e.exports=(r=n(2),i=(o=r).lib.Base,s=o.enc.Utf8,void(o.algo.HMAC=i.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=s.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),i=this._iKey=t.clone(),c=o.words,a=i.words,u=0;u<n;u++)c[u]^=1549556828,a[u]^=909522486;o.sigBytes=i.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})))},function(e,t,n){var r,o,i;e.exports=(i=n(2),o=(r=i).lib.WordArray,r.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();for(var o=[],i=0;i<n;i+=3)for(var s=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,c=0;c<4&&i+.75*c<n;c++)o.push(r.charAt(s>>>6*(3-c)&63));var a=r.charAt(64);if(a)for(;o.length%4;)o.push(a);return o.join("")},parse:function(e){var t=e.length,n=this._map,r=this._reverseMap;if(!r){r=this._reverseMap=[];for(var i=0;i<n.length;i++)r[n.charCodeAt(i)]=i}var s=n.charAt(64);if(s){var c=e.indexOf(s);-1!==c&&(t=c)}return function(e,t,n){for(var r=[],i=0,s=0;s<t;s++)if(s%4){var c=n[e.charCodeAt(s-1)]<<s%4*2,a=n[e.charCodeAt(s)]>>>6-s%4*2;r[i>>>2]|=(c|a)<<24-i%4*8,i++}return o.create(r,i)}(e,t,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},i.enc.Base64)},function(e,t,n){var r;e.exports=(r=n(2),r.enc.Utf8)},function(e,t,n){"use strict";(function(e){var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.CloudbaseCache=void 0;var c=n(5),a=n(1),u=n(3),h=function(e){function t(t){var n=e.call(this)||this;return n._root=t,t.tcbCacheObject||(t.tcbCacheObject={}),n}return o(t,e),t.prototype.setItem=function(e,t){this._root.tcbCacheObject[e]=t},t.prototype.getItem=function(e){return this._root.tcbCacheObject[e]},t.prototype.removeItem=function(e){delete this._root.tcbCacheObject[e]},t.prototype.clear=function(){delete this._root.tcbCacheObject},t}(c.AbstractStorage);function l(e,t){switch(e){case"local":return t.localStorage?t.localStorage:(a.printWarn(u.ERRORS.INVALID_PARAMS,"localStorage is not supported on current platform"),new h(t.root));case"none":return new h(t.root);case"session":return t.sessionStorage?t.sessionStorage:(a.printWarn(u.ERRORS.INVALID_PARAMS,"sessionStorage is not supported on current platform"),new h(t.root));default:return t.localStorage?t.localStorage:(a.printWarn(u.ERRORS.INVALID_PARAMS,"localStorage is not supported on current platform"),new h(t.root))}}var f=function(){function t(e){this.keys={};var t=e.persistence,n=e.platformInfo,r=void 0===n?{}:n,o=e.keys,i=void 0===o?{}:o,s=e.alwaysLocalKeys,c=void 0===s?[]:s;this._platformInfo=r,this._alwaysLocalKeys=c,this._storage||(this._persistence=r.adapter.primaryStorage||t,this._storage=l(this._persistence,r.adapter),this.keys=i)}return Object.defineProperty(t.prototype,"mode",{get:function(){return this._storage.mode||"sync"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"persistence",{get:function(){return this._persistence},enumerable:!1,configurable:!0}),t.prototype.updatePersistence=function(e){if("async"!==this.mode){if(e!==this._persistence){var t="local"===this._persistence;this._persistence=e;var n=l(e,this._platformInfo.adapter);for(var r in this.keys){var o=this.keys[r];if(!t||!this._alwaysLocalKeys.includes(r)){var i=this._storage.getItem(o);a.isUndefined(i)||a.isNull(i)||(n.setItem(o,i),this._storage.removeItem(o))}}this._storage=n}}else a.printWarn(u.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use updatePersistenceAsync insteed")},t.prototype.updatePersistenceAsync=function(e){return i(this,void 0,void 0,(function(){var t,n,r,o,i,c,u,h;return s(this,(function(s){switch(s.label){case 0:if(e===this._persistence)return[2];for(o in t="local"===this._persistence,this._persistence=e,n=l(e,this._platformInfo.adapter),r=[],this.keys)r.push(o);i=0,s.label=1;case 1:return i<r.length?(c=r[i],u=this.keys[c],t&&this._alwaysLocalKeys.includes(c)?[3,4]:[4,this._storage.getItem(u)]):[3,5];case 2:return h=s.sent(),a.isUndefined(h)||a.isNull(h)?[3,4]:(n.setItem(u,h),[4,this._storage.removeItem(u)]);case 3:s.sent(),s.label=4;case 4:return i++,[3,1];case 5:return this._storage=n,[2]}}))}))},t.prototype.setStore=function(e,t,n){if("async"!==this.mode){if(this._storage)try{var r={version:n||"localCachev1",content:t};this._storage.setItem(e,JSON.stringify(r))}catch(e){throw new Error(JSON.stringify({code:u.ERRORS.OPERATION_FAIL,msg:"["+u.getSdkName()+"]["+u.ERRORS.OPERATION_FAIL+"]setStore failed",info:e}))}}else a.printWarn(u.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use setStoreAsync insteed")},t.prototype.setStoreAsync=function(e,t,n){return i(this,void 0,void 0,(function(){var r;return s(this,(function(o){switch(o.label){case 0:if(!this._storage)return[2];o.label=1;case 1:return o.trys.push([1,3,,4]),r={version:n||"localCachev1",content:t},[4,this._storage.setItem(e,JSON.stringify(r))];case 2:return o.sent(),[3,4];case 3:return o.sent(),[2];case 4:return[2]}}))}))},t.prototype.getStore=function(t,n){var r;if("async"!==this.mode){try{if(void 0!==e&&(null===(r=e.env)||void 0===r?void 0:r.tcb_token))return e.env.tcb_token;if(!this._storage)return""}catch(e){return""}n=n||"localCachev1";var o=this._storage.getItem(t);return o&&o.indexOf(n)>=0?JSON.parse(o).content:""}a.printWarn(u.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use getStoreAsync insteed")},t.prototype.getStoreAsync=function(t,n){var r;return i(this,void 0,void 0,(function(){var o;return s(this,(function(i){switch(i.label){case 0:try{if(void 0!==e&&(null===(r=e.env)||void 0===r?void 0:r.tcb_token))return[2,e.env.tcb_token];if(!this._storage)return[2,""]}catch(e){return[2,""]}return n=n||"localCachev1",[4,this._storage.getItem(t)];case 1:return(o=i.sent())&&o.indexOf(n)>=0?[2,JSON.parse(o).content]:[2,""]}}))}))},t.prototype.removeStore=function(e){"async"!==this.mode?this._storage.removeItem(e):a.printWarn(u.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use removeStoreAsync insteed")},t.prototype.removeStoreAsync=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._storage.removeItem(e)];case 1:return t.sent(),[2]}}))}))},t}();t.CloudbaseCache=f}).call(this,n(16))},function(e,t){var n,r,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function c(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var a,u=[],h=!1,l=-1;function f(){h&&a&&(h=!1,a.length?u=a.concat(u):l=-1,u.length&&p())}function p(){if(!h){var e=c(f);h=!0;for(var t=u.length;t;){for(a=u,u=[];++l<t;)a&&a[l].run();l=-1,t=u.length}a=null,h=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function y(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new d(e,t)),1!==u.length||h||c(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=y,o.addListener=y,o.once=y,o.off=y,o.removeListener=y,o.removeAllListeners=y,o.emit=y,o.prependListener=y,o.prependOnceListener=y,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,c=i.length;s<c;s++,o++)r[o]=i[s];return r};Object.defineProperty(t,"__esModule",{value:!0}),t.removeEventListener=t.activateEvent=t.addEventListener=t.CloudbaseEventEmitter=t.IErrorEvent=t.CloudbaseEvent=void 0;var s=n(1);var c=function(e,t){this.data=t||null,this.name=e};t.CloudbaseEvent=c;var a=function(e){function t(t,n){var r=e.call(this,"error",{error:t,data:n})||this;return r.error=t,r}return o(t,e),t}(c);t.IErrorEvent=a;var u=function(){function e(){this._listeners={}}return e.prototype.on=function(e,t){return function(e,t,n){n[e]=n[e]||[],n[e].push(t)}(e,t,this._listeners),this},e.prototype.off=function(e,t){return function(e,t,n){if(null==n?void 0:n[e]){var r=n[e].indexOf(t);-1!==r&&n[e].splice(r,1)}}(e,t,this._listeners),this},e.prototype.fire=function(e,t){if(s.isInstanceOf(e,a))return console.error(e.error),this;var n=s.isString(e)?new c(e,t||{}):e,r=n.name;if(this._listens(r)){n.target=this;for(var o=0,u=this._listeners[r]?i(this._listeners[r]):[];o<u.length;o++){u[o].call(this,n)}}return this},e.prototype._listens=function(e){return this._listeners[e]&&this._listeners[e].length>0},e}();t.CloudbaseEventEmitter=u;var h=new u;t.addEventListener=function(e,t){h.on(e,t)},t.activateEvent=function(e,t){void 0===t&&(t={}),h.fire(e,t)},t.removeEventListener=function(e,t){h.off(e,t)}},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(19),t)},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.stopAuthLoginWithOAuth=t.stopOAuthLoginWithAuth=t.catchErrorsDecorator=void 0;var i=n(1),s=n(3),c=!1;"undefined"!=typeof navigator&&navigator.userAgent&&(c=-1!==navigator.userAgent.indexOf("Firefox"));var a=c?/(\.js\/)?__decorate(\$\d+)?<@.*\d$/:/(\/\w+\.js\.)?__decorate(\$\d+)?\s*\(.*\)$/,u=/https?\:\/\/.+\:\d*\/.*\.js\:\d+\:\d+/;function h(e){var t=e.err,n=e.className,r=e.methodName,o=e.sourceLink;if(!o)return null;var i,s=t.stack.split("\n"),a=c?/^catchErrorsDecorator\/<\/descriptor.value@.*\d$/:new RegExp(n+"\\.descriptor.value\\s*\\[as\\s"+r+"\\]\\s*\\(.*\\)$"),h=c?/^catchErrorsDecorator\/<\/descriptor.value/:new RegExp(n+"\\.descriptor.value\\s*\\[as\\s"+r+"\\]"),l=s.findIndex((function(e){return a.test(e)}));if(-1!==l){var f=s.filter((function(e,t){return t>l}));f.unshift(s[l].replace(h,n+"."+r).replace(u,o)),(i=new Error).stack=(c?"@debugger":"Error")+"\n"+f.join("\n")}return i}t.catchErrorsDecorator=function(e){var t=e.mode,n=void 0===t?"async":t,c=e.customInfo,l=void 0===c?{}:c,f=e.title,p=e.messages,d=void 0===p?[]:p;return function(e,t,c){if(s.IS_DEBUG_MODE){var p=l.className||e.constructor.name,y=l.methodName||t,g=c.value,v=function(e){var t="",n=e.stack.split("\n"),r=n.findIndex((function(e){return a.test(e)}));if(-1!==r){var o=u.exec(n[r+1]||"");t=o?o[0]:""}return t}(new Error);c.value="sync"===n?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=h({err:new Error,className:p,methodName:y,sourceLink:v});try{return g.apply(this,e)}catch(e){var r=e,o=e.message,s={title:f||p+"."+y+" failed",content:[{type:"error",body:e}]};if(o&&/^\{.*\}$/.test(o)){var c=JSON.parse(o);s.subtitle=o,c.code&&(n?(n.code=c.code,n.msg=c.msg):(e.code=c.code,e.message=c.msg),r=n||e,s.content=d.map((function(e){return{type:"info",body:e}})))}throw i.printGroupLog(s),r}}:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(this,void 0,void 0,(function(){var t,n,r,s,c,a;return o(this,(function(o){switch(o.label){case 0:t=h({err:new Error,className:p,methodName:y,sourceLink:v}),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,g.apply(this,e)];case 2:return[2,o.sent()];case 3:throw n=o.sent(),r=n,s=n.message,c={title:f||p+"."+y+" failed",content:[{type:"error",body:n}]},s&&/^\{.*\}$/.test(s)&&(a=JSON.parse(s),c.subtitle=a,a.code&&(t?(t.code=a.code,t.message=a.msg):(n.code=a.code,n.message=a.msg),r=t||n,c.content=d.map((function(e){return{type:"info",body:e}})))),i.printGroupLog(c),r;case 4:return[2]}}))}))}}}},t.stopOAuthLoginWithAuth=function(){return function(e,t,n){var i=n.value;n.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(this,void 0,void 0,(function(){var t,n,r;return o(this,(function(o){switch(o.label){case 0:return t=this._fromApp,n=t.authInstance,(r=n)?[4,n.getLoginState()]:[3,2];case 1:r=o.sent(),o.label=2;case 2:if(r)throw Error("当前已使用 auth 登录，请手动退出 auth 登录后再进行 oauth 登录");return[2,i.apply(this,e)]}}))}))}}},t.stopAuthLoginWithOAuth=function(){return function(e,t,n){var i=n.value;n.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(this,void 0,void 0,(function(){var t,n,r;return o(this,(function(o){switch(o.label){case 0:return t=this._fromApp,n=t.oauthInstance||t.oauth(),(r=n)?[4,n.hasLoginState()]:[3,2];case 1:r=o.sent(),o.label=2;case 2:if(r)throw Error("当前已使用 oauth 登录，请手动退出 oauth 登录后再进行 auth 登录");return[2,i.apply(this,e)]}}))}))}}}},function(e,t,n){"use strict";function r(e){this.message=e}n.r(t),n.d(t,"InvalidTokenError",(function(){return s})),r.prototype=new Error,r.prototype.name="InvalidCharacterError";var o="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new r("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,o,i=0,s=0,c="";o=t.charAt(s++);~o&&(n=i%4?64*n+o:o,i++%4)?c+=String.fromCharCode(255&n>>(-2*i&6)):0)o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(o);return c};function i(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(o(e).replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(t)}catch(e){return o(t)}}function s(e){this.message=e}s.prototype=new Error,s.prototype.name="InvalidTokenError",t.default=function(e,t){if("string"!=typeof e)throw new s("Invalid token specified");var n=!0===(t=t||{}).header?0:1;try{return JSON.parse(i(e.split(".")[n]))}catch(e){throw new s("Invalid token specified: "+e.message)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"LoginState",(function(){return ft})),n.d(t,"Auth",(function(){return pt})),n.d(t,"AuthProvider",(function(){return l})),n.d(t,"EVENTS",(function(){return dt})),n.d(t,"eventBus",(function(){return ht})),n.d(t,"registerAuth",(function(){return gt})),n.d(t,"registerProvider",(function(){return vt}));var r,o=n(0),i=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},s=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},c=function(e){return i(void 0,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return t=e.oauthInstance||e.oauth(),(n=t)?[4,t.hasLoginState()]:[3,2];case 1:n=r.sent(),r.label=2;case 2:return n?[2,{authType:"oauth",instance:t}]:[2,{}]}}))}))};!function(e){e.ANONYMOUS="ANONYMOUS",e.WECHAT="WECHAT",e.WECHAT_PUBLIC="WECHAT-PUBLIC",e.WECHAT_OPEN="WECHAT-OPEN",e.CUSTOM="CUSTOM",e.EMAIL="EMAIL",e.USERNAME="USERNAME",e.NULL="NULL",e.PHONE="PHONE"}(r||(r={}));var a,u=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},h=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},l=function(){function e(e){this._config=e,this._cache=e.cache,this._request=e.request,this._fromApp=e._fromApp}return e.prototype.checkLocalLoginState=function(){return u(this,void 0,void 0,(function(){var e,t,n,r,o,i;return h(this,(function(s){switch(s.label){case 0:return e=this._cache.keys,t=e.accessTokenKey,n=e.accessTokenExpireKey,[4,this._cache.getStoreAsync(t)];case 1:return r=s.sent(),[4,this._cache.getStoreAsync(n)];case 2:return o=s.sent(),r?o&&o>Date.now()?[4,(i=new ft({envId:this._config.env,cache:this._cache,request:this._request})).checkLocalStateAsync()]:[3,4]:[3,4];case 3:return s.sent(),[2,i];case 4:return[2]}}))}))},e.prototype.setRefreshToken=function(e){return u(this,void 0,void 0,(function(){var t,n,r,o;return h(this,(function(i){switch(i.label){case 0:return t=this._cache.keys,n=t.accessTokenKey,r=t.accessTokenExpireKey,o=t.refreshTokenKey,[4,this._cache.removeStoreAsync(n)];case 1:return i.sent(),[4,this._cache.removeStoreAsync(r)];case 2:return i.sent(),[4,this._cache.setStoreAsync(o,e)];case 3:return i.sent(),[2]}}))}))},e.prototype.setAccessToken=function(e,t){return u(this,void 0,void 0,(function(){var n,r,o;return h(this,(function(i){switch(i.label){case 0:return n=this._cache.keys,r=n.accessTokenKey,o=n.accessTokenExpireKey,[4,this._cache.setStoreAsync(r,e)];case 1:return i.sent(),[4,this._cache.setStoreAsync(o,t)];case 2:return i.sent(),[2]}}))}))},e.prototype.refreshUserInfo=function(){return u(this,void 0,void 0,(function(){var e;return h(this,(function(t){switch(t.label){case 0:return"auth.getUserInfo",[4,this._request.send("auth.getUserInfo",{})];case 1:return e=t.sent().data,[4,this.setLocalUserInfo(e)];case 2:return t.sent(),[2,e]}}))}))},e.prototype.setLocalUserInfo=function(e){return u(this,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return t=this._cache.keys.userInfoKey,[4,this._cache.setStoreAsync(t,e)];case 1:return n.sent(),[2]}}))}))},e}(),f=(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),p=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},g=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},v=o.constants.getSdkName,_=o.constants.ERRORS,m=o.constants.COMMUNITY_SITE_URL,b=o.helpers.catchErrorsDecorator;var w="/auth/v1/provider/uri",A="/auth/v1/provider/token",I="/auth/v1/signin/with/provider",O="/auth/v1/user/me",S=function(e){function t(t,n){void 0===n&&(n={});var r=e.call(this,t)||this;r.popupWindowRef=null,r.providerId=n.providerId,r.clientId=n.clientId||t.env,r.responseType=n.responseType||"token",r.scope=n.scope||"",r.redirectUri=n.redirectUri||"",r.syncProfile=n.syncProfile||!1,r.forceDisableSignUp=n.forceDisableSignUp||!1;var o=r.recvMessageFromPopup.bind(r);return window.removeEventListener("message",o),window.addEventListener("message",o,!1),r}return f(t,e),t.prototype.signIn=function(){return y(this,void 0,void 0,(function(){return g(this,(function(e){return[2,o.utils.printWarn(_.OPERATION_FAIL,"API signIn has been deprecated, please use signInWithRedirect insteed")]}))}))},t.prototype.signInWithPopup=function(e){return void 0===e&&(e={}),y(this,void 0,void 0,(function(){return g(this,(function(t){return[2,this.jumpToProviderPage(e)]}))}))},t.prototype.signInWithModal=function(e){return y(this,void 0,void 0,(function(){var t,n,r;return g(this,(function(o){switch(o.label){case 0:return[4,this.fetchProviderRedirectURI()];case 1:return t=o.sent().uri,(n=document.getElementById(e)).style.display="block","\n    <style>\n      /* The Modal (background) */\n      .modal {\n        display: none; /* Hidden by default */\n        position: fixed; /* Stay in place */\n        z-index: 1; /* Sit on top */\n        padding-top: 100px; /* Location of the box */\n        left: 0;\n        top: 0;\n        width: 100%; /* Full width */\n        height: 100%; /* Full height */\n        overflow: auto; /* Enable scroll if needed */\n        background-color: rgb(0,0,0); /* Fallback color */\n        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */\n      }\n  \n      /* Modal Content */\n      .modal-content {\n        background-color: #fefefe;\n        margin: auto;\n        padding: 20px;\n        border: 1px solid #888;\n        /* width: 80%; */\n      }\n  \n      /* The Close Button */\n      .close {\n        color: #aaaaaa;\n        float: right;\n        font-size: 28px;\n        font-weight: bold;\n      }\n      .close:hover,\n      .close:focus {\n        color: #000;\n        text-decoration: none;\n        cursor: pointer;\n      }\n      </style>\n    ",r='\n      <div class="modal-content">\n        <span class="close">&times;</span>\n        <iframe id="loginIframe" src="'+t+'" title="iframe Example 1" width="400" height="300"></iframe>\n      </div>\n    ','\n      <script>\n      // Get the <span> element that closes the modal\n      var span = document.getElementsByClassName("close")[0];\n      \n      // When the user clicks on <span> (x), close the modal\n      span.onclick = function() {\n        modal.style.display = "none";\n      }\n  \n      // When the user clicks anywhere outside of the modal, close it\n      window.onclick = function(event) {\n        if (event.target == modal) {\n          modal.style.display = "none";\n        }\n      }\n\n      const loginIframe = document.getElementById("loginIframe")\n      <\/script>\n    ',n.innerHTML="\n      "+r+'\n      \n    <style>\n      /* The Modal (background) */\n      .modal {\n        display: none; /* Hidden by default */\n        position: fixed; /* Stay in place */\n        z-index: 1; /* Sit on top */\n        padding-top: 100px; /* Location of the box */\n        left: 0;\n        top: 0;\n        width: 100%; /* Full width */\n        height: 100%; /* Full height */\n        overflow: auto; /* Enable scroll if needed */\n        background-color: rgb(0,0,0); /* Fallback color */\n        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */\n      }\n  \n      /* Modal Content */\n      .modal-content {\n        background-color: #fefefe;\n        margin: auto;\n        padding: 20px;\n        border: 1px solid #888;\n        /* width: 80%; */\n      }\n  \n      /* The Close Button */\n      .close {\n        color: #aaaaaa;\n        float: right;\n        font-size: 28px;\n        font-weight: bold;\n      }\n      .close:hover,\n      .close:focus {\n        color: #000;\n        text-decoration: none;\n        cursor: pointer;\n      }\n      </style>\n    \n      \n      <script>\n      // Get the <span> element that closes the modal\n      var span = document.getElementsByClassName("close")[0];\n      \n      // When the user clicks on <span> (x), close the modal\n      span.onclick = function() {\n        modal.style.display = "none";\n      }\n  \n      // When the user clicks anywhere outside of the modal, close it\n      window.onclick = function(event) {\n        if (event.target == modal) {\n          modal.style.display = "none";\n        }\n      }\n\n      const loginIframe = document.getElementById("loginIframe")\n      <\/script>\n    \n    ',[2]}}))}))},t.prototype.jumpToProviderPage=function(e){return void 0===e&&(e={}),y(this,void 0,void 0,(function(){var t,n,r,i,s,c;return g(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.fetchProviderRedirectURI()];case 1:return t=a.sent().uri,n=e.popup||{},r=n.target||"_blank",i=n.features||"toolbar=no, menubar=no, width=600, height=700, top=100, left=100",null===(s=this.popupWindowRef)||s.closed?s=window.open(t,r,i):this.popupWindowUrl!==t&&(s&&!s.closed&&s.close(),s=window.open(t,r,i)),s?(this.popupWindowUrl=t,this.popupWindowRef=s,this.popupWindowRef.focus(),[3,3]):[2,o.utils.printWarn(_.OPERATION_FAIL,"打开第三方登录授权失败，可能是禁用了浏览器弹窗，uri: "+t)];case 2:throw c=a.sent(),this.popupWindowRef&&!this.popupWindowRef.closed&&this.popupWindowRef.close(),new Error("["+v()+"]["+_.UNKOWN_ERROR+"]"+c);case 3:return[2]}}))}))},t.prototype.recvMessageFromPopup=function(e){if(e.isTrusted&&this.popupWindowRef===e.source&&"cloudbase-login-redirect"===e.data.source){var t=e.data;this.continueSignIn(t.callbackInfo),this.popupWindowRef.closed||this.popupWindowRef.close()}},t.prototype.continueSignIn=function(e){return y(this,void 0,void 0,(function(){var t,n,r,o,i,s,c,a,u;return g(this,(function(h){switch(h.label){case 0:return e=e||this.getAuthPrividerCallbackInfoFromUrl(),[4,this.signInWithProvider(e)];case 1:if(t=h.sent(),n=this._cache.keys,r=n.accessTokenKey,o=n.accessTokenExpireKey,i=n.refreshTokenKey,s=t.refresh_token,c=t.access_token,a=t.expires_in,!c||!a)throw new Error(JSON.stringify({code:"SignFailure"}));return[4,Promise.all([this._cache.setStoreAsync(i,s),this._cache.setStoreAsync(r,c),this._cache.setStoreAsync(o,1e3*a+Date.now())])];case 2:return h.sent(),ht.fire(dt.LOGIN_STATE_CHANGED),ht.fire(dt.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:"OAUTH2."+this.providerId,persistence:this._config.persistence}),[4,(u=new ft({envId:this._config.env,cache:this._cache,request:this._request})).checkLocalStateAsync()];case 3:return h.sent(),[2,u]}}))}))},t.prototype.getAuthPrividerCallbackInfoFromUrl=function(){return decodeURIComponent(new URL(window.location.href).hash.replace("#","")).split("&").reduce((function(e,t){var n=t.split("="),r=n[0],o=n[1];return e[r]=o,e}),{})},t.prototype.fetchProviderRedirectURI=function(){return y(this,void 0,void 0,(function(){var e,t,n,r,i,s,c,a;return g(this,(function(u){switch(u.label){case 0:return e={response_type:this.responseType,provider_id:this.providerId,client_id:this.clientId,scope:this.scope,redirect_uri:this.redirectUri,state:btoa(JSON.stringify({t:Date.now(),provider_id:this.providerId,client_id:this.clientId,routeKey:""}))},t=e.response_type,n=e.provider_id,r=e.client_id,i=e.scope,s=e.redirect_uri,c=e.state,a=o.utils.toQueryString({response_type:t,provider_id:n,client_id:r,scope:i,redirect_uri:s,state:c}),[4,this.fetch(w+"?"+a,{method:"GET"})];case 1:return[2,u.sent().json()]}}))}))},t.prototype.fetchProviderToken=function(e){return y(this,void 0,void 0,(function(){var t;return g(this,(function(n){switch(n.label){case 0:return t={provider_id:this.providerId,client_id:this.clientId,provider_redirect_uri:e.href},e.code?t.provider_code=e.code:e.access_token?t.provider_access_token=e.access_token:e.id_token&&(t.provider_id_token=e.id_token),[4,this.fetch(A,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)})];case 1:return[2,n.sent().json()]}}))}))},t.prototype.signInWithProvider=function(e){return y(this,void 0,void 0,(function(){var t,n;return g(this,(function(r){switch(r.label){case 0:return[4,this.fetchProviderToken(e)];case 1:return t=r.sent(),n={client_id:this.clientId,provider_token:t.provider_token,sync_profile:this.syncProfile,force_disable_sign_up:this.forceDisableSignUp},[4,this.fetch(I,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)})];case 2:return[2,r.sent().json()]}}))}))},t.prototype.refreshUserInfo=function(){return y(this,void 0,void 0,(function(){var e,t;return g(this,(function(n){switch(n.label){case 0:return[4,this._request.getAccessToken()];case 1:return e=n.sent().accessToken,t="Bearer "+e,[4,this.fetch(O,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:t}})];case 2:return[2,n.sent().json()]}}))}))},t.prototype.fetch=function(e,t){return y(this,void 0,void 0,(function(){var n,r,o,i;return g(this,(function(s){switch(s.label){case 0:return[4,this._request.fetch(e,t)];case 1:return n=s.sent(),r=n.headers.get("SeqId")||n.headers.get("RequestId"),n.status>=400&&n.status<500?[4,n.json()]:[3,3];case 2:throw o=s.sent(),i=o.request_id||r,new Error("["+v()+"][OAuth2AuthProvider][status:"+n.status+"]["+o.error+"("+o.error_code+")] "+o.error_description+" ("+i+")");case 3:return n.status>=500?[4,n.json()]:[3,5];case 4:throw o=s.sent(),i=o.request_id||r,new Error("["+v()+"][OAuth2AuthProvider][status:"+n.status+"]["+o.error+"("+o.error_code+")] "+o.error_description+" ("+i+")");case 5:return[2,n]}}))}))},p([b({title:"跳转第三方登录平台失败",messages:["请确认以下各项：","  1 - 调用 auth().oAuth2AuthProvider() 的参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+m]}),d("design:type",Function),d("design:paramtypes",[Object]),d("design:returntype",Promise)],t.prototype,"signInWithPopup",null),t}(l),P=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),k=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},E=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},T=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},R=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},N=o.constants.ERRORS,U=o.constants.COMMUNITY_SITE_URL,L=o.utils.throwError,x=o.utils.isString,C=o.events.addEventListener,j=o.helpers.catchErrorsDecorator,M=o.helpers.stopAuthLoginWithOAuth,q=function(e){function t(t){var n=e.call(this,t)||this;return n._onConverted=n._onConverted.bind(n),C(dt.ANONYMOUS_CONVERTED,n._onConverted),n}return P(t,e),t.prototype.signIn=function(){return T(this,void 0,void 0,(function(){var e,t,n,o,i,s,c;return R(this,(function(a){switch(a.label){case 0:return[4,this._cache.updatePersistenceAsync("local")];case 1:return a.sent(),e=this._cache.keys,t=e.anonymousUuidKey,n=e.refreshTokenKey,[4,this._cache.getStoreAsync(t)];case 2:return o=a.sent(),[4,this._cache.getStoreAsync(n)];case 3:return i=a.sent(),[4,this._request.send("auth.signInAnonymously",{anonymous_uuid:o,refresh_token:i})];case 4:return(s=a.sent()).uuid&&s.refresh_token?[4,this._setAnonymousUUID(s.uuid)]:[3,10];case 5:return a.sent(),[4,this.setRefreshToken(s.refresh_token)];case 6:return a.sent(),[4,this._request.refreshAccessToken()];case 7:return a.sent(),ht.fire(dt.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:r.ANONYMOUS,persistence:"local"}),ht.fire(dt.LOGIN_STATE_CHANGED),[4,(c=new ft({envId:this._config.env,cache:this._cache,request:this._request})).checkLocalStateAsync()];case 8:return a.sent(),[4,c.user.refresh()];case 9:return a.sent(),[2,c];case 10:throw new Error(JSON.stringify({code:N.OPERATION_FAIL,msg:JSON.stringify(s)||"anonymous signIn failed"}))}}))}))},t.prototype.linkAndRetrieveDataWithTicket=function(e){return T(this,void 0,void 0,(function(){var t,n,o,i,s,c,a;return R(this,(function(u){switch(u.label){case 0:return x(e)||L(N.INVALID_PARAMS,"ticket must be a string"),t=this._cache.keys,n=t.anonymousUuidKey,o=t.refreshTokenKey,[4,this._cache.getStoreAsync(n)];case 1:return i=u.sent(),[4,this._cache.getStoreAsync(o)];case 2:return s=u.sent(),[4,this._request.send("auth.linkAndRetrieveDataWithTicket",{anonymous_uuid:i,refresh_token:s,ticket:e})];case 3:return(c=u.sent()).refresh_token?[4,this._clearAnonymousUUID()]:[3,8];case 4:return u.sent(),[4,this.setRefreshToken(c.refresh_token)];case 5:return u.sent(),[4,this._request.refreshAccessToken()];case 6:return u.sent(),ht.fire(dt.ANONYMOUS_CONVERTED,{env:this._config.env}),ht.fire(dt.LOGIN_TYPE_CHANGED,{loginType:r.CUSTOM,persistence:"local"}),[4,(a=new ft({envId:this._config.env,cache:this._cache,request:this._request})).checkLocalStateAsync()];case 7:return u.sent(),[2,a];case 8:L(N.OPERATION_FAIL,JSON.stringify(c)||"linkAndRetrieveDataWithTicket failed"),u.label=9;case 9:return[2]}}))}))},t.prototype._setAnonymousUUID=function(e){return T(this,void 0,void 0,(function(){var t,n,o;return R(this,(function(i){switch(i.label){case 0:return t=this._cache.keys,n=t.anonymousUuidKey,o=t.loginTypeKey,[4,this._cache.removeStoreAsync(n)];case 1:return i.sent(),[4,this._cache.setStoreAsync(n,e)];case 2:return i.sent(),[4,this._cache.setStoreAsync(o,r.ANONYMOUS)];case 3:return i.sent(),[2]}}))}))},t.prototype._clearAnonymousUUID=function(){return T(this,void 0,void 0,(function(){return R(this,(function(e){switch(e.label){case 0:return[4,this._cache.removeStoreAsync(this._cache.keys.anonymousUuidKey)];case 1:return e.sent(),[2]}}))}))},t.prototype._onConverted=function(e){return T(this,void 0,void 0,(function(){return R(this,(function(t){switch(t.label){case 0:return e.data.env!==this._config.env?[2]:[4,this._cache.updatePersistenceAsync(this._config.persistence)];case 1:return t.sent(),[2]}}))}))},k([M(),j({title:"匿名登录失败",messages:["请确认以下各项：","  1 - 当前环境是否开启了匿名登录","  2 - 调用 auth().anonymouseProvider().signIn() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+U]}),E("design:type",Function),E("design:paramtypes",[]),E("design:returntype",Promise)],t.prototype,"signIn",null),t}(l),W=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),D=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},H=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},G=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},F=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},K=o.constants.ERRORS,B=o.constants.COMMUNITY_SITE_URL,Y=o.utils.isString,V=o.helpers.catchErrorsDecorator,J=o.helpers.stopAuthLoginWithOAuth,z=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return W(t,e),t.prototype.signIn=function(e){return G(this,void 0,void 0,(function(){var t,n,o,i,s,c,a;return F(this,(function(u){switch(u.label){case 0:if(!Y(e))throw new Error(JSON.stringify({code:K.INVALID_PARAMS,msg:"ticket must be a string"}));return t=this._cache.keys.refreshTokenKey,i=(o=this._request).send,s=["auth.signInWithTicket"],c={ticket:e},[4,this._cache.getStoreAsync(t)];case 1:return[4,i.apply(o,s.concat([(c.refresh_token=u.sent()||"",c)]))];case 2:return(n=u.sent()).refresh_token?[4,this.setRefreshToken(n.refresh_token)]:[3,7];case 3:return u.sent(),[4,this._request.refreshAccessToken()];case 4:return u.sent(),ht.fire(dt.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:r.CUSTOM,persistence:this._config.persistence}),ht.fire(dt.LOGIN_STATE_CHANGED),[4,this.refreshUserInfo()];case 5:return u.sent(),[4,(a=new ft({envId:this._config.env,cache:this._cache,request:this._request})).checkLocalStateAsync()];case 6:return u.sent(),[2,a];case 7:throw new Error(JSON.stringify({code:K.OPERATION_FAIL,msg:"custom signIn failed"}))}}))}))},D([J(),V({title:"自定义登录失败",messages:["请确认以下各项：","  1 - 当前环境是否开启了自定义登录","  2 - 调用 auth().customAuthProvider().signIn() 的语法或参数是否正确","  3 - ticket 是否归属于当前环境","  4 - 创建 ticket 的自定义登录私钥是否过期","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+B]}),H("design:type",Function),H("design:paramtypes",[String]),H("design:returntype",Promise)],t.prototype,"signIn",null),t}(l),X=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),$=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Q=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Z=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},ee=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},te=o.utils.throwError,ne=o.utils.isString,re=o.constants.ERRORS,oe=o.constants.COMMUNITY_SITE_URL,ie=o.helpers.catchErrorsDecorator,se=o.helpers.stopAuthLoginWithOAuth,ce=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return X(t,e),t.prototype.signIn=function(e,t){return Z(this,void 0,void 0,(function(){var n,o,i,s,c;return ee(this,(function(a){switch(a.label){case 0:return ne(e)||te(re.INVALID_PARAMS,"email must be a string"),n=this._cache.keys.refreshTokenKey,[4,this._request.send("auth.signIn",{loginType:"EMAIL",email:e,password:t,refresh_token:this._cache.getStore(n)||""})];case 1:return o=a.sent(),i=o.refresh_token,s=o.access_token,c=o.access_token_expire,i?[4,this.setRefreshToken(i)]:[3,8];case 2:return a.sent(),s&&c?[4,this.setAccessToken(s,c)]:[3,4];case 3:return a.sent(),[3,6];case 4:return[4,this._request.refreshAccessToken()];case 5:a.sent(),a.label=6;case 6:return[4,this.refreshUserInfo()];case 7:return a.sent(),ht.fire(dt.LOGIN_STATE_CHANGED),ht.fire(dt.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:r.EMAIL,persistence:this._config.persistence}),[2,new ft({envId:this._config.env,cache:this._cache,request:this._request})];case 8:o.code?te(re.OPERATION_FAIL,"Email login fail["+o.code+"] "+o.message):te(re.OPERATION_FAIL,"Email login fail"),a.label=9;case 9:return[2]}}))}))},t.prototype.signUp=function(e,t){return Z(this,void 0,void 0,(function(){return ee(this,(function(n){return[2,this._request.send("auth.signUpWithEmailAndPassword",{email:e,password:t})]}))}))},t.prototype.resetPassword=function(e){return Z(this,void 0,void 0,(function(){return ee(this,(function(t){return[2,this._request.send("auth.sendPasswordResetEmail",{email:e})]}))}))},t.prototype.resetPasswordWithToken=function(e,t){return Z(this,void 0,void 0,(function(){return ee(this,(function(n){return[2,this._request.send("auth.resetPasswordWithToken",{token:e,newPassword:t})]}))}))},t.prototype.activate=function(e){return Z(this,void 0,void 0,(function(){return ee(this,(function(t){return[2,this._request.send("auth.activateEndUserMail",{token:e})]}))}))},$([se(),ie({title:"邮箱密码登录失败",messages:["请确认以下各项：","  1 - 调用 auth().emailAuthProvider() 的语法或参数是否正确","  2 - 当前环境是否开通了邮箱登录","  3 - 邮箱地址与密码是否匹配","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+oe]}),Q("design:type",Function),Q("design:paramtypes",[String,String]),Q("design:returntype",Promise)],t.prototype,"signIn",null),$([se(),ie({title:"邮箱注册失败",messages:["请确认以下各项：","  1 - 调用 auth().signUpWithEmailAndPassword() 的语法或参数是否正确","  2 - 当前环境是否开通了邮箱登录","  3 - 此邮箱地址是否已经被其他用户占用","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+oe]}),Q("design:type",Function),Q("design:paramtypes",[String,String]),Q("design:returntype",Promise)],t.prototype,"signUp",null),$([ie({title:"重置密码失败",messages:["请确认以下各项：","  1 - 调用 auth().sendPasswordResetEmail() 的语法或参数是否正确","  2 - 当前环境是否开通了邮箱登录","  3 - 此邮箱地址是否已经与当前用户绑定","  4 - 此邮箱地址是否已经被其他用户占用","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+oe]}),Q("design:type",Function),Q("design:paramtypes",[String]),Q("design:returntype",Promise)],t.prototype,"resetPassword",null),$([ie({title:"重置密码失败",messages:["请确认以下各项：","  1 - 调用语法或参数是否正确","  2 - 当前环境是否开通了邮箱登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+oe]}),Q("design:type",Function),Q("design:paramtypes",[String,String]),Q("design:returntype",Promise)],t.prototype,"resetPasswordWithToken",null),$([ie({title:"邮箱激活失败",messages:["请确认以下各项：","  1 - 调用语法或参数是否正确","  2 - 当前环境是否开通了邮箱登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+oe]}),Q("design:type",Function),Q("design:paramtypes",[String]),Q("design:returntype",Promise)],t.prototype,"activate",null),t}(l),ae=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ue=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},he=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},le=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},fe=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},pe=o.utils.throwError,de=o.utils.isString,ye=o.utils.transformPhone,ge=o.constants.ERRORS,ve=o.constants.COMMUNITY_SITE_URL,_e=o.helpers.catchErrorsDecorator,me=o.helpers.stopAuthLoginWithOAuth,be="SIGNIN",we="SIGNUP",Ae="FORCERESETPWD",Ie=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ae(t,e),t.prototype.signIn=function(e){return le(this,void 0,void 0,(function(){var t,n,o,i,s,c,a,u,h;return fe(this,(function(l){switch(l.label){case 0:return t=e.phoneNumber,n=e.phoneCode,o=e.password,i=e.signMethod,de(t)||pe(ge.INVALID_PARAMS,"phoneNumber must be a string"),de(n)||de(o)||pe(ge.INVALID_PARAMS,"phoneCode or password must be a string"),i||(i=be),s=this._cache.keys.refreshTokenKey,[4,this._request.send("auth.signIn",{loginType:r.PHONE,phoneNumber:ye(t),phoneCode:n,password:o,refresh_token:this._cache.getStore(s)||"",signMethod:i})];case 1:return c=l.sent(),a=c.refresh_token,u=c.access_token,h=c.access_token_expire,a?[4,this.setRefreshToken(a)]:[3,8];case 2:return l.sent(),u&&h?[4,this.setAccessToken(u,h)]:[3,4];case 3:return l.sent(),[3,6];case 4:return[4,this._request.refreshAccessToken()];case 5:l.sent(),l.label=6;case 6:return[4,this.refreshUserInfo()];case 7:return l.sent(),ht.fire(dt.LOGIN_STATE_CHANGED),ht.fire(dt.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:r.PHONE,persistence:this._config.persistence}),[2,new ft({envId:this._config.env,cache:this._cache,request:this._request})];case 8:c.code?pe(ge.OPERATION_FAIL,"Phone login fail["+c.code+"] "+c.message):pe(ge.OPERATION_FAIL,"Phone login fail"),l.label=9;case 9:return[2]}}))}))},t.prototype.signUp=function(e,t,n){return le(this,void 0,void 0,(function(){return fe(this,(function(r){return[2,this.signIn({phoneNumber:e,phoneCode:t,password:n,signMethod:we})]}))}))},t.prototype.forceResetPwd=function(e,t,n){return le(this,void 0,void 0,(function(){return fe(this,(function(r){return[2,this.signIn({phoneNumber:e,phoneCode:t,password:n,signMethod:Ae})]}))}))},ue([me(),_e({title:"手机号登录失败",messages:["请确认以下各项：","  1 - 调用 auth().SmsAuthProvider() 的语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","  3 - 短信验证码/密码是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+ve]}),he("design:type",Function),he("design:paramtypes",[Object]),he("design:returntype",Promise)],t.prototype,"signIn",null),ue([me(),_e({title:"手机短信注册失败",messages:["请确认以下各项：","  1 - 调用 auth().signUpWithPhoneCode() 的语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+ve]}),he("design:type",Function),he("design:paramtypes",[String,String,String]),he("design:returntype",Promise)],t.prototype,"signUp",null),ue([_e({title:"手机密码重置失败",messages:["请确认以下各项：","  1 - 调用 auth().forceResetPwd() 的语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+ve]}),he("design:type",Function),he("design:paramtypes",[String,String,String]),he("design:returntype",Promise)],t.prototype,"forceResetPwd",null),t}(l),Oe=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Se=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Pe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ke=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},Ee=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},Te=o.utils.printWarn,Re=o.constants.ERRORS,Ne=o.constants.COMMUNITY_SITE_URL,Ue=o.helpers.catchErrorsDecorator,Le=o.helpers.stopAuthLoginWithOAuth,xe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Oe(t,e),t.prototype.signIn=function(e,t){return ke(this,void 0,void 0,(function(){var n,o,i,s,c,a,u,h,l;return Ee(this,(function(f){switch(f.label){case 0:if("string"!=typeof e)throw new Error(JSON.stringify({code:Re.INVALID_PARAMS,msg:"username must be a string"}));return"string"!=typeof t&&(t="",Te(Re.INVALID_PARAMS,"password is empty")),n=this._cache.keys.refreshTokenKey,s=(i=this._request).send,c=["auth.signIn"],a={loginType:r.USERNAME,username:e,password:t},[4,this._cache.getStoreAsync(n)];case 1:return[4,s.apply(i,c.concat([(a.refresh_token=f.sent()||"",a)]))];case 2:return o=f.sent(),u=o.refresh_token,h=o.access_token_expire,l=o.access_token,u?[4,this.setRefreshToken(u)]:[3,9];case 3:return f.sent(),l&&h?[4,this.setAccessToken(l,h)]:[3,5];case 4:return f.sent(),[3,7];case 5:return[4,this._request.refreshAccessToken()];case 6:f.sent(),f.label=7;case 7:return[4,this.refreshUserInfo()];case 8:return f.sent(),ht.fire(dt.LOGIN_STATE_CHANGED),ht.fire(dt.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:r.USERNAME,persistence:this._config.persistence}),[2,new ft({envId:this._config.env,cache:this._cache,request:this._request})];case 9:throw o.code?new Error(JSON.stringify({code:Re.OPERATION_FAIL,msg:"login by username failed:["+o.code+"] "+o.message})):new Error(JSON.stringify({code:Re.OPERATION_FAIL,msg:"login by username failed"}));case 10:return[2]}}))}))},Se([Le(),Ue({title:"用户名密码登录失败",messages:["请确认以下各项：","  1 - 调用 auth().signInWithUsernameAndPassword() 的语法或参数是否正确","  2 - 当前环境是否开通了用户名密码登录","  3 - 用户名密码是否匹配","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Ne]}),Pe("design:type",Function),Pe("design:paramtypes",[String,String]),Pe("design:returntype",Promise)],t.prototype,"signIn",null),t}(l),Ce=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),je=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Me=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},qe=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},We=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},De=o.constants.getSdkName,He=o.constants.ERRORS,Ge=o.constants.COMMUNITY_SITE_URL,Fe=o.adapters.RUNTIME,Ke=o.utils.getQuery,Be=o.utils.getHash,Ye=o.utils.removeParam,Ve=o.utils.printWarn,Je=o.helpers.catchErrorsDecorator,ze=function(e){function t(t,n,r,o){var i=e.call(this,t)||this;return i._runtime=t.runtime,i._appid=n,i._scope=r,i._state=o||"weixin",i}return Ce(t,e),t.prototype.signIn=function(){return qe(this,void 0,void 0,(function(){return We(this,(function(e){return[2,Ve(He.OPERATION_FAIL,"API signIn has been deprecated, please use signInWithRedirect insteed")]}))}))},t.prototype.signInWithRedirect=function(){return qe(this,void 0,void 0,(function(){return We(this,(function(e){return[2,this._redirect()]}))}))},t.prototype.getRedirectResult=function(e){return qe(this,void 0,void 0,(function(){var t;return We(this,(function(n){return(t=Xe())?[2,this._signInWithCode(t,e)]:[2,null]}))}))},t.prototype.getLinkRedirectResult=function(e){return void 0===e&&(e={}),qe(this,void 0,void 0,(function(){var t,n,r,o,i,s;return We(this,(function(c){return t=e.withUnionId,n=void 0!==t&&t,(r=Xe())?(o=this._appid,i=function(e){switch(e){case"snsapi_login":return"WECHAT-OPEN";default:return"WECHAT-PUBLIC"}}(this._scope),s=this._runtime===Fe.WX_MP?"1":"0",[2,this._request.send("auth.linkWithWeixinCode",{payload:{appid:o,loginType:i,code:r,hybridMiniapp:s,withUnionId:n}})]):[2,null]}))}))},t.prototype._redirect=function(){var e=Ye("code",location.href);e=Ye("state",e),e=encodeURIComponent(e);var t="//open.weixin.qq.com/connect/oauth2/authorize";"snsapi_login"===this._scope&&(t="//open.weixin.qq.com/connect/qrconnect");try{location.href=t+"?appid="+this._appid+"&redirect_uri="+e+"&response_type=code&scope="+this._scope+"&state="+this._state+"#wechat_redirect"}catch(e){throw new Error("["+De()+"]["+He.UNKOWN_ERROR+"]"+e)}},t.prototype._signInWithCode=function(e,t){return qe(this,void 0,void 0,(function(){var n,o,i,s,c,a,u,h;return We(this,(function(l){switch(l.label){case 0:return n=this._cache.keys,o=n.accessTokenKey,i=n.accessTokenExpireKey,s=n.refreshTokenKey,c=function(e){switch(e){case"snsapi_login":return"WECHAT-OPEN";default:return"WECHAT-PUBLIC"}}(this._scope),[4,this._getRefreshTokenByWXCode(this._appid,c,e,t)];case 1:return a=l.sent(),u=a.refreshToken,[4,this._cache.setStoreAsync(s,u)];case 2:return l.sent(),a.accessToken?[4,this._cache.setStoreAsync(o,a.accessToken)]:[3,4];case 3:l.sent(),l.label=4;case 4:return a.accessTokenExpire?[4,this._cache.setStoreAsync(i,String(a.accessTokenExpire+Date.now()))]:[3,6];case 5:l.sent(),l.label=6;case 6:return ht.fire(dt.LOGIN_STATE_CHANGED),ht.fire(dt.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:r.WECHAT,persistence:this._config.persistence}),[4,this.refreshUserInfo()];case 7:return l.sent(),[4,(h=new ft({envId:this._config.env,cache:this._cache,request:this._request})).checkLocalStateAsync()];case 8:return l.sent(),[2,h]}}))}))},t.prototype._getRefreshTokenByWXCode=function(e,t,n,r){return void 0===r&&(r={}),qe(this,void 0,void 0,(function(){var o,i,s,c,a,u;return We(this,(function(h){return o=r.withUnionId,i=void 0!==o&&o,s=r.createUser,c=void 0===s||s,a="snsapi_base"!==this._scope&&(r.syncUserInfo||!1),"auth.signIn",u=this._runtime===Fe.WX_MP?"1":"0",[2,this._request.send("auth.signIn",{appid:e,loginType:t,hybridMiniapp:u,syncUserInfo:a,loginCredential:n,withUnionId:i,createUser:c}).then((function(e){if(e.code)throw new Error("["+De()+"]["+He.OPERATION_FAIL+"] failed login via wechat: "+e.code);if(e.refresh_token)return{refreshToken:e.refresh_token,accessToken:e.access_token,accessTokenExpire:e.access_token_expire};throw new Error("["+De()+"]["+He.OPERATION_FAIL+"] action:getJwt not return refreshToken")}))]}))}))},je([Je({title:"跳转微信公众号授权失败",messages:["请确认以下各项：","  1 - 调用 auth().weixinAuthProvider().signInWithRedirect() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Ge]}),Me("design:type",Function),Me("design:paramtypes",[]),Me("design:returntype",Promise)],t.prototype,"signInWithRedirect",null),je([Je({title:"微信公众号登录失败",messages:["请确认以下各项：","  1 - 调用 auth().weixinAuthProvider().getRedirectResult() 的语法或参数是否正确","  2 - 当前环境是否开通了微信公众号登录授权","  3 - 微信公众号的 AppId 与 AppSecret 配置是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Ge]}),Me("design:type",Function),Me("design:paramtypes",[Object]),Me("design:returntype",Promise)],t.prototype,"getRedirectResult",null),je([Je({title:"获取微信重定向绑定结果",messages:["请确认以下各项：","  1 - 调用 auth().weixinAuthProvider().getLinkRedirectResult() 的语法或参数是否正确","  2 - 当前环境是否开通了微信公众号登录授权","  3 - 微信公众号的 AppId 与 AppSecret 配置是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Ge]}),Me("design:type",Function),Me("design:paramtypes",[Object]),Me("design:returntype",Promise)],t.prototype,"getLinkRedirectResult",null),t}(l);function Xe(){return Ke("code")||Be("code")}var $e=function(){return($e=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Qe=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Ze=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},et=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},tt=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},nt=o.events.CloudbaseEventEmitter,rt=o.adapters.RUNTIME,ot=o.utils.printWarn,it=o.utils.throwError,st=o.utils.transformPhone,ct=o.constants.ERRORS,at=o.constants.COMMUNITY_SITE_URL,ut=o.helpers.catchErrorsDecorator,ht=new nt,lt=function(){function e(e){var t=e.cache,n=e.request;this._cache=t,this._request=n,this._setUserInfo()}return e.prototype.checkLocalInfo=function(){return et(this,void 0,void 0,(function(){return tt(this,(function(e){return this.uid=this._getLocalUserInfo("uid"),this.loginType=this._getLocalUserInfo("loginType"),this.openid=this._getLocalUserInfo("wxOpenId"),this.wxOpenId=this._getLocalUserInfo("wxOpenId"),this.wxPublicId=this._getLocalUserInfo("wxPublicId"),this.unionId=this._getLocalUserInfo("wxUnionId"),this.qqMiniOpenId=this._getLocalUserInfo("qqMiniOpenId"),this.customUserId=this._getLocalUserInfo("customUserId"),this.nickName=this._getLocalUserInfo("nickName"),this.gender=this._getLocalUserInfo("gender"),this.avatarUrl=this._getLocalUserInfo("avatarUrl"),this.email=this._getLocalUserInfo("email"),this.hasPassword=Boolean(this._getLocalUserInfo("hasPassword")),this.phone=this._getLocalUserInfo("phone"),this.username=this._getLocalUserInfo("username"),this.location={country:this._getLocalUserInfo("country"),province:this._getLocalUserInfo("province"),city:this._getLocalUserInfo("city")},[2]}))}))},e.prototype.checkLocalInfoAsync=function(){return et(this,void 0,void 0,(function(){var e,t,n,r,o,i,s,c,a,u,h,l,f,p,d,y,g,v;return tt(this,(function(_){switch(_.label){case 0:return e=this,[4,this._getLocalUserInfoAsync("uid")];case 1:return e.uid=_.sent(),t=this,[4,this._getLocalUserInfoAsync("loginType")];case 2:return t.loginType=_.sent(),n=this,[4,this._getLocalUserInfoAsync("wxOpenId")];case 3:return n.openid=_.sent(),r=this,[4,this._getLocalUserInfoAsync("wxOpenId")];case 4:return r.wxOpenId=_.sent(),o=this,[4,this._getLocalUserInfoAsync("wxPublicId")];case 5:return o.wxPublicId=_.sent(),i=this,[4,this._getLocalUserInfoAsync("wxUnionId")];case 6:return i.unionId=_.sent(),s=this,[4,this._getLocalUserInfoAsync("qqMiniOpenId")];case 7:return s.qqMiniOpenId=_.sent(),c=this,[4,this._getLocalUserInfoAsync("customUserId")];case 8:return c.customUserId=_.sent(),a=this,[4,this._getLocalUserInfoAsync("nickName")];case 9:return a.nickName=_.sent(),u=this,[4,this._getLocalUserInfoAsync("gender")];case 10:return u.gender=_.sent(),h=this,[4,this._getLocalUserInfoAsync("avatarUrl")];case 11:return h.avatarUrl=_.sent(),l=this,[4,this._getLocalUserInfoAsync("email")];case 12:return l.email=_.sent(),f=this,p=Boolean,[4,this._getLocalUserInfoAsync("hasPassword")];case 13:return f.hasPassword=p.apply(void 0,[_.sent()]),d=this,[4,this._getLocalUserInfoAsync("phone")];case 14:return d.phone=_.sent(),y=this,[4,this._getLocalUserInfoAsync("username")];case 15:return y.username=_.sent(),g=this,v={},[4,this._getLocalUserInfoAsync("country")];case 16:return v.country=_.sent(),[4,this._getLocalUserInfoAsync("province")];case 17:return v.province=_.sent(),[4,this._getLocalUserInfoAsync("city")];case 18:return g.location=(v.city=_.sent(),v),[2]}}))}))},e.prototype.linkWithTicket=function(e){if("string"!=typeof e)throw new Error("ticket must be string");return this._request.send("auth.linkWithTicket",{ticket:e})},e.prototype.linkWithRedirect=function(e){e.signInWithRedirect()},e.prototype.getLinkedUidList=function(){return et(this,void 0,void 0,(function(){var e,t,n,r,o,i;return tt(this,(function(s){switch(s.label){case 0:return[4,this._request.send("auth.getLinkedUidList",{})];case 1:for(e=s.sent().data,t=!1,n=e.users,r=0,o=n;r<o.length;r++)if((i=o[r]).wxOpenId&&i.wxPublicId){t=!0;break}return[2,{users:n,hasPrimaryUid:t}]}}))}))},e.prototype.setPrimaryUid=function(e){return this._request.send("auth.setPrimaryUid",{uid:e})},e.prototype.unlink=function(e){return this._request.send("auth.unlink",{platform:e})},e.prototype.update=function(e){return et(this,void 0,void 0,(function(){var t,n,r,o,i,s,c;return tt(this,(function(a){switch(a.label){case 0:return t=e.nickName,n=e.gender,r=e.avatarUrl,o=e.province,i=e.country,s=e.city,[4,this._request.send("auth.updateUserInfo",{nickName:t,gender:n,avatarUrl:r,province:o,country:i,city:s})];case 1:return c=a.sent().data,this._setLocalUserInfo(c),[2]}}))}))},e.prototype.updatePassword=function(e,t){return this._request.send("auth.updatePassword",{oldPassword:t,newPassword:e})},e.prototype.updateEmail=function(e,t){return this._request.send("auth.updateEmail",{newEmail:e,password:t})},e.prototype.updateUsername=function(e){return"string"!=typeof e&&it(ct.INVALID_PARAMS,"username must be a string"),this._request.send("auth.updateUsername",{username:e})},e.prototype.refresh=function(){return et(this,void 0,void 0,(function(){var e;return tt(this,(function(t){switch(t.label){case 0:return"auth.getUserInfo",[4,this._request.send("auth.getUserInfo",{})];case 1:return e=t.sent().data,this._setLocalUserInfo(e),[2,e]}}))}))},e.prototype.linkWithPhoneNumber=function(e,t){return et(this,void 0,void 0,(function(){return tt(this,(function(n){return[2,this._request.send("auth.linkOrUpdatePhoneNumber",{phoneNumber:st(e),phoneCode:t})]}))}))},e.prototype.updatePhoneNumber=function(e,t){return et(this,void 0,void 0,(function(){return tt(this,(function(n){return[2,this._request.send("auth.linkOrUpdatePhoneNumber",{phoneNumber:st(e),phoneCode:t})]}))}))},e.prototype._getLocalUserInfo=function(e){var t=this._cache.keys.userInfoKey;return this._cache.getStore(t)[e]},e.prototype._getLocalUserInfoAsync=function(e){return et(this,void 0,void 0,(function(){var t;return tt(this,(function(n){switch(n.label){case 0:return t=this._cache.keys.userInfoKey,[4,this._cache.getStoreAsync(t)];case 1:return[2,n.sent()[e]]}}))}))},e.prototype._setUserInfo=function(){var e=this,t=this._cache.keys.userInfoKey,n=this._cache.getStore(t);["uid","loginType","openid","wxOpenId","wxPublicId","unionId","qqMiniOpenId","email","hasPassword","customUserId","nickName","gender","avatarUrl","phone","username"].forEach((function(t){e[t]=n[t]})),this.location={country:n.country,province:n.province,city:n.city}},e.prototype._setLocalUserInfo=function(e){var t=this._cache.keys.userInfoKey;this._cache.setStore(t,e),this._setUserInfo()},Qe([ut({title:"绑定自定义登录失败",messages:["请确认以下各项：","  1 - 调用 User.linkWithTicket() 的语法或参数是否正确","  2 - 此账户是否已经绑定自定义登录","  3 - ticket 参数是否归属当前环境","  4 - 创建 ticket 的自定义登录私钥是否过期","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+at]}),Ze("design:type",Function),Ze("design:paramtypes",[String]),Ze("design:returntype",Promise)],e.prototype,"linkWithTicket",null),Qe([ut({title:"绑定第三方登录方式失败",messages:["请确认以下各项：","  1 - 调用 User.linkWithRedirect() 的语法或参数是否正确","  2 - 此账户是否已经绑定此第三方","  3 - 此第三方是否已经授权","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+at]}),Ze("design:type",Function),Ze("design:paramtypes",[Object]),Ze("design:returntype",void 0)],e.prototype,"linkWithRedirect",null),Qe([ut({title:"获取账户列表失败",messages:["请确认以下各项：","  1 - 调用 User.getLinkedUidList() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+at]}),Ze("design:type",Function),Ze("design:paramtypes",[]),Ze("design:returntype",Promise)],e.prototype,"getLinkedUidList",null),Qe([ut({title:"设置微信主账号失败",messages:["请确认以下各项：","  1 - 调用 User.setPrimaryUid() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+at]}),Ze("design:type",Function),Ze("design:paramtypes",[String]),Ze("design:returntype",void 0)],e.prototype,"setPrimaryUid",null),Qe([ut({title:"接触绑定失败",messages:["请确认以下各项：","  1 - 调用 User.unlink() 的语法或参数是否正确","  2 - 当前账户是否已经与此登录方式解绑","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+at]}),Ze("design:type",Function),Ze("design:paramtypes",[String]),Ze("design:returntype",void 0)],e.prototype,"unlink",null),Qe([ut({title:"更新用户信息失败",messages:["请确认以下各项：","  1 - 调用 User.update() 的语法或参数是否正确","  2 - 用户信息中是否包含非法值","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+at]}),Ze("design:type",Function),Ze("design:paramtypes",[Object]),Ze("design:returntype",Promise)],e.prototype,"update",null),Qe([ut({title:"更新密码失败",messages:["请确认以下各项：","  1 - 调用 User.updatePassword() 的语法或参数是否正确","  3 - 新密码中是否包含非法字符","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+at]}),Ze("design:type",Function),Ze("design:paramtypes",[String,String]),Ze("design:returntype",void 0)],e.prototype,"updatePassword",null),Qe([ut({title:"更新邮箱地址失败",messages:["请确认以下各项：","  1 - 调用 User.updateEmail() 的语法或参数是否正确","  2 - 当前环境是否开通了邮箱密码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+at]}),Ze("design:type",Function),Ze("design:paramtypes",[String,String]),Ze("design:returntype",void 0)],e.prototype,"updateEmail",null),Qe([ut({title:"更新用户名失败",messages:["请确认以下各项：","  1 - 调用 User.updateUsername() 的语法或参数是否正确","  2 - 当前环境是否开通了用户名密码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+at]}),Ze("design:type",Function),Ze("design:paramtypes",[String]),Ze("design:returntype",void 0)],e.prototype,"updateUsername",null),Qe([ut({title:"刷新本地用户信息失败",messages:["请确认以下各项：","  1 - 调用 User.refresh() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+at]}),Ze("design:type",Function),Ze("design:paramtypes",[]),Ze("design:returntype",Promise)],e.prototype,"refresh",null),Qe([ut({title:"绑定手机号失败",messages:["请确认以下各项：","  1 - 调用 auth().linkWithPhoneNumber() 的语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+at]}),Ze("design:type",Function),Ze("design:paramtypes",[String,String]),Ze("design:returntype",Promise)],e.prototype,"linkWithPhoneNumber",null),Qe([ut({title:"更新手机号失败",messages:["请确认以下各项：","  1 - 调用语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+at]}),Ze("design:type",Function),Ze("design:paramtypes",[String,String]),Ze("design:returntype",Promise)],e.prototype,"updatePhoneNumber",null),e}(),ft=function(){function e(e){var t=e.envId,n=e.cache,r=e.request;t||it(ct.INVALID_PARAMS,"envId is not defined"),this._cache=n,this.user=new lt({cache:n,request:r})}return e.prototype.checkLocalState=function(){return et(this,void 0,void 0,(function(){var e,t,n,r,o,i,s;return tt(this,(function(c){return e=this._cache.keys,t=e.refreshTokenKey,n=e.accessTokenKey,r=e.accessTokenExpireKey,o=this._cache.getStore(t),i=this._cache.getStore(n),s=this._cache.getStore(r),this.credential={refreshToken:o,accessToken:i,accessTokenExpire:s},this._loginType=this._cache.getStore(this._cache.keys.loginTypeKey),this.user.checkLocalInfo(),[2]}))}))},e.prototype.checkLocalStateAsync=function(){return et(this,void 0,void 0,(function(){var e,t,n,r,o,i,s,c;return tt(this,(function(a){switch(a.label){case 0:return e=this._cache.keys,t=e.refreshTokenKey,n=e.accessTokenKey,r=e.accessTokenExpireKey,[4,this._cache.getStoreAsync(t)];case 1:return o=a.sent(),[4,this._cache.getStoreAsync(n)];case 2:return i=a.sent(),[4,this._cache.getStoreAsync(r)];case 3:return s=a.sent(),this.credential={refreshToken:o,accessToken:i,accessTokenExpire:s},c=this,[4,this._cache.getStoreAsync(this._cache.keys.loginTypeKey)];case 4:return c._loginType=a.sent(),[4,this.user.checkLocalInfoAsync()];case 5:return a.sent(),[2]}}))}))},Object.defineProperty(e.prototype,"isAnonymousAuth",{get:function(){return this.loginType===r.ANONYMOUS},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCustomAuth",{get:function(){return this.loginType===r.CUSTOM},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isWeixinAuth",{get:function(){return this.loginType===r.WECHAT||this.loginType===r.WECHAT_OPEN||this.loginType===r.WECHAT_PUBLIC},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isUsernameAuth",{get:function(){return this.loginType===r.USERNAME},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loginType",{get:function(){return this._loginType},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isPhoneAuth",{get:function(){return this.loginType===r.PHONE},enumerable:!1,configurable:!0}),e}(),pt=function(){function e(e){this._config=e,this._cache=e.cache,this._request=e.request,this._runtime=e.runtime||rt.WEB,ht.on(dt.LOGIN_TYPE_CHANGED,this._onLoginTypeChanged.bind(this))}return Object.defineProperty(e.prototype,"currentUser",{get:function(){if("async"!==this._cache.mode){var e=this.hasLoginState();return e&&e.user||null}ot(ct.INVALID_OPERATION,"current platform's storage is asynchronous, please use getCurrenUser insteed")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loginType",{get:function(){return this._cache.getStore(this._cache.keys.loginTypeKey)},enumerable:!1,configurable:!0}),e.prototype.getCurrenUser=function(){return et(this,void 0,void 0,(function(){var e,t,n,r,o;return tt(this,(function(i){switch(i.label){case 0:return e=this._config._fromApp,[4,c(e)];case 1:return t=i.sent(),n=t.authType,r=t.instance,"oauth"!==n?[3,3]:[4,r.getUserInfo()];case 2:return[2,i.sent()];case 3:return[4,this.getLoginState()];case 4:return(o=i.sent())?[4,o.user.checkLocalInfoAsync()]:[3,6];case 5:return i.sent(),[2,o.user||null];case 6:return[2,null]}}))}))},e.prototype.getLoginType=function(){return et(this,void 0,void 0,(function(){return tt(this,(function(e){switch(e.label){case 0:return[4,this._cache.getStoreAsync(this._cache.keys.loginTypeKey)];case 1:return[2,e.sent()]}}))}))},e.prototype.getAccessToken=function(){return et(this,void 0,void 0,(function(){var e;return tt(this,(function(t){switch(t.label){case 0:return e={},[4,this._request.getAccessToken()];case 1:return[2,(e.accessToken=t.sent().accessToken,e.env=this._config.env,e)]}}))}))},e.prototype.weixinAuthProvider=function(e){var t=e.appid,n=e.scope,r=e.state;return this._weixinAuthProvider||(this._weixinAuthProvider=new ze($e($e({},this._config),{cache:this._cache,request:this._request,runtime:this._runtime}),t,n,r)),this._weixinAuthProvider},e.prototype.anonymousAuthProvider=function(){return this._anonymousAuthProvider||(this._anonymousAuthProvider=new q($e($e({},this._config),{cache:this._cache,request:this._request}))),this._anonymousAuthProvider},e.prototype.customAuthProvider=function(){return this._customAuthProvider||(this._customAuthProvider=new z($e($e({},this._config),{cache:this._cache,request:this._request}))),this._customAuthProvider},e.prototype.emailAuthProvider=function(){return this._emailAuthProvider||(this._emailAuthProvider=new ce($e($e({},this._config),{cache:this._cache,request:this._request}))),this._emailAuthProvider},e.prototype.usernameAuthProvider=function(){return this._usernameAuthProvider||(this._usernameAuthProvider=new xe($e($e({},this._config),{cache:this._cache,request:this._request}))),this._usernameAuthProvider},e.prototype.phoneAuthProvider=function(){return this._phoneAuthProvider||(this._phoneAuthProvider=new Ie($e($e({},this._config),{cache:this._cache,request:this._request}))),this._phoneAuthProvider},e.prototype.oAuth2AuthProvider=function(e){return void 0===e&&(e={}),this._oAuth2AuthProvider||(this._oAuth2AuthProvider=new S($e($e({},this._config),{cache:this._cache,request:this._request,runtime:this._runtime}),e)),this._oAuth2AuthProvider},e.prototype.signWithOAuth2Popup=function(){this._oAuth2AuthProvider.signInWithPopup()},e.prototype.signInWithOAuth2Modal=function(e){this._oAuth2AuthProvider.signInWithModal(e)},e.prototype.signInWithUsernameAndPassword=function(e,t){return et(this,void 0,void 0,(function(){return tt(this,(function(n){return[2,this.usernameAuthProvider().signIn(e,t)]}))}))},e.prototype.isUsernameRegistered=function(e){return et(this,void 0,void 0,(function(){var t;return tt(this,(function(n){switch(n.label){case 0:return"string"!=typeof e&&it(ct.INVALID_PARAMS,"username must be a string"),[4,this._request.send("auth.isUsernameRegistered",{username:e})];case 1:return[2,null==(t=n.sent().data)?void 0:t.isRegistered]}}))}))},e.prototype.signInWithEmailAndPassword=function(e,t){return et(this,void 0,void 0,(function(){return tt(this,(function(n){return[2,this.emailAuthProvider().signIn(e,t)]}))}))},e.prototype.signUpWithEmailAndPassword=function(e,t){return et(this,void 0,void 0,(function(){return tt(this,(function(n){return[2,this.emailAuthProvider().signUp(e,t)]}))}))},e.prototype.sendPasswordResetEmail=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return[2,this.emailAuthProvider().resetPassword(e)]}))}))},e.prototype.signOut=function(){return et(this,void 0,void 0,(function(){var e,t,n,o,i,s,a,u,h,l,f,p,d,y,g,v,_;return tt(this,(function(m){switch(m.label){case 0:return e=this._config._fromApp,[4,c(e)];case 1:return t=m.sent(),n=t.authType,o=t.instance,"oauth"!==n?[3,3]:[4,o.signOut()];case 2:return[2,m.sent()];case 3:return[4,this.getLoginType()];case 4:return i=m.sent(),s=this._cache.keys,a=s.refreshTokenKey,u=s.accessTokenKey,h=s.accessTokenExpireKey,[4,this._cache.getStoreAsync(a)];case 5:return(l=m.sent())?i.startsWith("OAUTH2")?[4,this._cache.getStoreAsync(u)]:[3,15]:[2];case 6:return f=m.sent(),d=Number,[4,this._cache.getStoreAsync(h)];case 7:return p=d.apply(void 0,[m.sent()]),f?Date.now()<p?[4,this._request.fetch("/auth/v1/revoke",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({token:f})})]:[3,13]:[3,14];case 8:return y=m.sent(),g=y.headers.get("SeqId")||y.headers.get("RequestId"),y.status>=400&&y.status<500?[4,y.json()]:[3,10];case 9:throw v=m.sent(),_=v.request_id||g,new Error("[OAuth2AuthProvider][status:"+y.status+"]["+v.error+"("+v.error_code+")] "+v.error_description+" ("+_+")");case 10:return y.status>=500?[4,y.json()]:[3,12];case 11:throw v=m.sent(),_=v.request_id||g,new Error("[OAuth2AuthProvider][status:"+y.status+"]["+v.error+"("+v.error_code+")] "+v.error_description+" ("+_+")");case 12:return[3,13];case 13:return[3,14];case 14:return[3,17];case 15:return[4,this._request.send("auth.logout",{refresh_token:l})];case 16:m.sent(),m.label=17;case 17:return this._cache.removeStoreAsync(a),this._cache.removeStoreAsync(u),this._cache.removeStoreAsync(h),ht.fire(dt.LOGIN_STATE_CHANGED),ht.fire(dt.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:r.NULL,persistence:this._config.persistence}),[2,!0]}}))}))},e.prototype.onLoginStateChanged=function(e){return et(this,void 0,void 0,(function(){var t,n=this;return tt(this,(function(r){switch(r.label){case 0:return ht.on(dt.LOGIN_STATE_CHANGED,(function(){return et(n,void 0,void 0,(function(){var t;return tt(this,(function(n){switch(n.label){case 0:return[4,this.getLoginState()];case 1:return t=n.sent(),e.call(this,t),[2]}}))}))})),[4,this.getLoginState()];case 1:return t=r.sent(),e.call(this,t),[2]}}))}))},e.prototype.onLoginStateExpired=function(e){ht.on(dt.LOGIN_STATE_EXPIRED,e.bind(this))},e.prototype.onAccessTokenRefreshed=function(e){ht.on(dt.ACCESS_TOKEN_REFRESHD,e.bind(this))},e.prototype.onAnonymousConverted=function(e){ht.on(dt.ANONYMOUS_CONVERTED,e.bind(this))},e.prototype.onLoginTypeChanged=function(e){var t=this;ht.on(dt.LOGIN_TYPE_CHANGED,(function(){return et(t,void 0,void 0,(function(){var t;return tt(this,(function(n){switch(n.label){case 0:return[4,this.getLoginState()];case 1:return t=n.sent(),e.call(this,t),[2]}}))}))}))},e.prototype.hasLoginState=function(){var e=this._config._fromApp.oauthInstance,t=null==e?void 0:e.hasLoginStateSync();if(t)return t;if("async"!==this._cache.mode){var n=this._cache.keys.refreshTokenKey;if(this._cache.getStore(n)){var r=new ft({envId:this._config.env,cache:this._cache,request:this._request});return r.checkLocalState(),r}return null}ot(ct.INVALID_OPERATION,"current platform's storage is asynchronous, please use getLoginState insteed")},e.prototype.getLoginState=function(){return et(this,void 0,void 0,(function(){var e,t,n,r,o,i;return tt(this,(function(s){switch(s.label){case 0:return e=this._config._fromApp,t=e.oauthInstance||e.oauth(),(r=t)?[4,t.getLoginState()]:[3,2];case 1:r=s.sent(),s.label=2;case 2:return(n=r)?[2,n]:(o=this._cache.keys.refreshTokenKey,[4,this._cache.getStoreAsync(o)]);case 3:return s.sent()?[4,(i=new ft({envId:this._config.env,cache:this._cache,request:this._request})).checkLocalStateAsync()]:[3,5];case 4:return s.sent(),[2,i];case 5:return[2,null]}}))}))},e.prototype.shouldRefreshAccessToken=function(e){this._request._shouldRefreshAccessTokenHook=e.bind(this)},e.prototype.getUserInfo=function(){return et(this,void 0,void 0,(function(){var e;return tt(this,(function(t){switch(t.label){case 0:return"auth.getUserInfo",[4,this._request.send("auth.getUserInfo",{})];case 1:return(e=t.sent()).code?[2,e]:[2,$e($e({},e.data),{requestId:e.seqId})]}}))}))},e.prototype.getAuthHeader=function(){var e=this._cache.keys,t=e.refreshTokenKey,n=e.accessTokenKey,r=this._cache.getStore(t);return{"x-cloudbase-credentials":this._cache.getStore(n)+"/@@/"+r}},e.prototype.getAuthHeaderAsync=function(){return et(this,void 0,void 0,(function(){var e,t,n,r;return tt(this,(function(o){switch(o.label){case 0:return[4,this._request.refreshAccessToken()];case 1:return o.sent(),e=this._cache.keys,t=e.refreshTokenKey,n=e.accessTokenKey,[4,this._cache.getStoreAsync(t)];case 2:return r=o.sent(),[4,this._cache.getStoreAsync(n)];case 3:return[2,{"x-cloudbase-credentials":o.sent()+"/@@/"+r}]}}))}))},e.prototype.sendPhoneCode=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){switch(t.label){case 0:return[4,this._request.send("auth.sendPhoneCode",{phoneNumber:st(e)})];case 1:return[2,"Ok"===t.sent().data.SendStatus]}}))}))},e.prototype.signUpWithPhoneCode=function(e,t,n){return et(this,void 0,void 0,(function(){return tt(this,(function(r){return[2,this.phoneAuthProvider().signUp(e,t,n)]}))}))},e.prototype.signInWithPhoneCodeOrPassword=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return[2,this.phoneAuthProvider().signIn(e)]}))}))},e.prototype.forceResetPwdByPhoneCode=function(e){return et(this,void 0,void 0,(function(){return tt(this,(function(t){return[2,this.phoneAuthProvider().signIn($e($e({},e),{signMethod:Ae}))]}))}))},e.prototype._onLoginTypeChanged=function(e){return et(this,void 0,void 0,(function(){var t,n,r;return tt(this,(function(o){switch(o.label){case 0:return t=e.data,n=t.loginType,r=t.persistence,t.env!==this._config.env?[2]:[4,this._cache.updatePersistenceAsync(r)];case 1:return o.sent(),[4,this._cache.setStoreAsync(this._cache.keys.loginTypeKey,n)];case 2:return o.sent(),[2]}}))}))},Qe([ut({title:"获取用户信息失败",messages:["请确认以下各项：","  1 - 调用 auth().getCurrenUser() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+at]}),Ze("design:type",Function),Ze("design:paramtypes",[]),Ze("design:returntype",Promise)],e.prototype,"getCurrenUser",null),Qe([ut({title:"获取用户是否被占用失败",messages:["请确认以下各项：","  1 - 调用 auth().isUsernameRegistered() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+at]}),Ze("design:type",Function),Ze("design:paramtypes",[String]),Ze("design:returntype",Promise)],e.prototype,"isUsernameRegistered",null),Qe([ut({title:"用户登出失败",messages:["请确认以下各项：","  1 - 调用 auth().signOut() 的语法或参数是否正确","  2 - 当前用户是否为匿名登录（匿名登录不支持signOut）","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+at]}),Ze("design:type",Function),Ze("design:paramtypes",[]),Ze("design:returntype",Promise)],e.prototype,"signOut",null),Qe([ut({title:"获取本地登录态失败",messages:["请确认以下各项：","  1 - 调用 auth().getLoginState() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+at]}),Ze("design:type",Function),Ze("design:paramtypes",[]),Ze("design:returntype",Promise)],e.prototype,"getLoginState",null),Qe([ut({title:"获取用户信息失败",messages:["请确认以下各项：","  1 - 是否已登录","  2 - 调用 auth().getUserInfo() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+at]}),Ze("design:type",Function),Ze("design:paramtypes",[]),Ze("design:returntype",Promise)],e.prototype,"getUserInfo",null),Qe([ut({title:"发送短信验证码失败",messages:["请确认以下各项：","  1 - 调用语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+at]}),Ze("design:type",Function),Ze("design:paramtypes",[String]),Ze("design:returntype",Promise)],e.prototype,"sendPhoneCode",null),e}(),dt={LOGIN_STATE_CHANGED:"loginStateChanged",LOGIN_STATE_EXPIRED:"loginStateExpire",LOGIN_TYPE_CHANGED:"loginTypeChanged",ANONYMOUS_CONVERTED:"anonymousConverted",ACCESS_TOKEN_REFRESHD:"refreshAccessToken"},yt={name:"auth",namespace:"auth",injectEvents:{bus:ht,events:[dt.LOGIN_TYPE_CHANGED,dt.LOGIN_STATE_EXPIRED,dt.LOGIN_STATE_CHANGED,dt.ACCESS_TOKEN_REFRESHD,dt.ANONYMOUS_CONVERTED]},entity:function(e){if(void 0===e&&(e={region:"",persistence:"local"}),this.authInstance)return ot(ct.INVALID_OPERATION,"every cloudbase instance should has only one auth object"),this.authInstance;var t=this.platform,n=t.adapter,r=t.runtime,o=e.persistence||n.primaryStorage;o&&o!==this.config.persistence&&this.updateConfig({persistence:o});var i=this.config,s=i.env,c=i.persistence,a=i.debug;return this.authInstance=new pt({env:s,region:e.region,persistence:c,debug:a,cache:this.cache,request:this.request,runtime:r,_fromApp:this}),this.authInstance}};try{cloudbase.registerComponent(yt)}catch(e){}function gt(e){try{e.registerComponent(yt)}catch(e){console.warn(e)}}function vt(e,t){pt.prototype[e]=function(n){var r="_"+e;return this[r]||(this[r]=new t($e($e({},n),this._config))),this[r]}}}])}));