!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("cloudbase_auth",[],e):"object"==typeof exports?exports.cloudbase_auth=e():t.cloudbase_auth=e()}("undefined"!=typeof window?window:this,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(t,e,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{a(r.next(t))}catch(t){o(t)}}function u(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}a((r=r.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.OAuth2Client=e.LocalCredentials=e.defaultStorage=e.generateRequestId=e.toResponseError=e.defaultRequest=void 0;var s=n(1),u=n(6),a=n(7);function c(){return u.uuidv4()}e.defaultRequest=function(t,e){return i(void 0,void 0,void 0,(function(){var n,r,i,u,a;return o(this,(function(o){switch(o.label){case 0:n=null,r=null,o.label=1;case 1:return o.trys.push([1,4,,5]),(i=Object.assign({},e)).method||(i.method="GET"),i.body&&"string"!=typeof i.body&&(i.body=JSON.stringify(i.body)),[4,fetch(t,i)];case 2:return[4,o.sent().json()];case 3:return(null==(u=o.sent())?void 0:u.error)?(r=u).error_uri=new URL(t).pathname:n=u,[3,5];case 4:return a=o.sent(),r={error:s.ErrorType.UNREACHABLE,error_description:a.message,error_uri:new URL(t).pathname},[3,5];case 5:if(r)throw r;return[2,n]}}))}))},e.toResponseError=function(t,e){var n,r=e||{};if(t instanceof Error)n={error:r.error||s.ErrorType.LOCAL,error_description:r.error_description||t.message,error_uri:r.error_uri,details:r.details||t.stack};else{var i=t||{};n={error:r.error||i.error||s.ErrorType.LOCAL,error_description:r.error_description||i.error_description,error_uri:r.error_uri||i.error_uri,details:r.details||i.details}}return n},e.generateRequestId=c;var h=function(){function t(){}return t.prototype.getItem=function(t){return i(this,void 0,void 0,(function(){return o(this,(function(e){return[2,window.localStorage.getItem(t)]}))}))},t.prototype.removeItem=function(t){return i(this,void 0,void 0,(function(){return o(this,(function(e){return window.localStorage.removeItem(t),[2]}))}))},t.prototype.setItem=function(t,e){return i(this,void 0,void 0,(function(){return o(this,(function(n){return window.localStorage.setItem(t,e),[2]}))}))},t.prototype.getItemSync=function(t){return window.localStorage.getItem(t)},t.prototype.removeItemSync=function(t){window.localStorage.removeItem(t)},t.prototype.setItemSync=function(t,e){window.localStorage.setItem(t,e)},t}();function l(t){var e=!0;return(null==t?void 0:t.expires_at)&&(null==t?void 0:t.access_token)&&(e=t.expires_at<new Date),e}e.defaultStorage=new h;var d=function(){function t(t){this._credentials=null,this._singlePromise=new a.SinglePromise,this._tokenSectionName=t.tokenSectionName,this._storage=t.storage}return t.prototype.setCredentials=function(t){return i(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return(null==t?void 0:t.expires_in)?(t.expires_at=new Date(Date.now()+1e3*(t.expires_in-30)),this._storage?(e=JSON.stringify(t),[4,this._storage.setItem(this._tokenSectionName,e)]):[3,2]):[3,3];case 1:n.sent(),n.label=2;case 2:return this._credentials=t,[3,6];case 3:return this._storage?[4,this._storage.removeItem(this._tokenSectionName)]:[3,5];case 4:n.sent(),n.label=5;case 5:this._credentials=null,n.label=6;case 6:return[2]}}))}))},t.prototype.getCredentials=function(){return i(this,void 0,void 0,(function(){var t=this;return o(this,(function(e){return[2,this._singlePromise.run("getCredentials",(function(){return i(t,void 0,void 0,(function(){var t;return o(this,(function(e){switch(e.label){case 0:return l(this._credentials)?(t=this,[4,this._getStorageCredentials()]):[3,2];case 1:t._credentials=e.sent(),e.label=2;case 2:return[2,this._credentials]}}))}))}))]}))}))},t.prototype._getStorageCredentials=function(){return i(this,void 0,void 0,(function(){var t=this;return o(this,(function(e){return[2,this._singlePromise.run("_getStorageCredentials",(function(){return i(t,void 0,void 0,(function(){var t,e;return o(this,(function(n){switch(n.label){case 0:return t=null,[4,this._storage.getItem(this._tokenSectionName)];case 1:if(null==(e=n.sent()))return[3,5];n.label=2;case 2:return n.trys.push([2,3,,5]),(null==(t=JSON.parse(e))?void 0:t.expires_at)&&(t.expires_at=new Date(t.expires_at)),[3,5];case 3:return n.sent(),[4,this._storage.removeItem(this._tokenSectionName)];case 4:return n.sent(),t=null,[3,5];case 5:return[2,t]}}))}))}))]}))}))},t.prototype._getStorageCredentialsSync=function(){var t=null,e=this._storage.getItemSync(this._tokenSectionName);if(null!=e)try{(null==(t=JSON.parse(e))?void 0:t.expires_at)&&(t.expires_at=new Date(t.expires_at))}catch(e){this._storage.removeItem(this._tokenSectionName),t=null}return t},t}();e.LocalCredentials=d;var f=function(){function t(n){this._singlePromise=new a.SinglePromise,this._apiOrigin=n.apiOrigin,this._clientId=n.clientId,this._retry=this._formatRetry(n.retry,t._defaultRetry),null!=n.baseRequest?this._baseRequest=n.baseRequest:this._baseRequest=e.defaultRequest,this._tokenInURL=n.tokenInURL,this._headers=n.headers,this._storage=n.storage||e.defaultStorage,this._localCredentials=new d({tokenSectionName:"credentials_"+n.clientId,storage:this._storage}),this._clientSecret=n.clientSecret,this._refreshTokenFunc=n.refreshTokenFunc||this._defaultRefreshTokenFunc}return t.prototype.setCredentials=function(t){return this._localCredentials.setCredentials(t)},t.prototype.getAccessToken=function(){return i(this,void 0,void 0,(function(){var t;return o(this,(function(e){switch(e.label){case 0:return[4,this._getCredentials()];case 1:return(null==(t=e.sent())?void 0:t.access_token)?[2,Promise.resolve(t.access_token)]:[2,Promise.reject({error:s.ErrorType.UNAUTHENTICATED})]}}))}))},t.prototype.request=function(e,n){return i(this,void 0,void 0,(function(){var i,s,u,a,h,l,d;return o(this,(function(o){switch(o.label){case 0:return n||(n={}),i=this._formatRetry(n.retry,this._retry),n.headers=n.headers||{},this._headers&&(n.headers=r(r({},this._headers),n.headers)),n.headers["x-request-id"]||(n.headers["x-request-id"]=c()),n.headers["x-device-id"]?[3,2]:[4,this._getDeviceId()];case 1:s=o.sent(),n.headers["x-device-id"]=s,o.label=2;case 2:return(null==n?void 0:n.withCredentials)?[4,this._getCredentials()]:[3,4];case 3:return(u=o.sent())&&(this._tokenInURL?(e.indexOf("?")<0&&(e+="?"),e+="access_token="+u.access_token):n.headers.Authorization=u.token_type+" "+u.access_token),[3,5];case 4:this._clientId&&e.indexOf("client_id")<0&&(e+=e.indexOf("?")<0?"?":"&",e+="client_id="+this._clientId),o.label=5;case 5:e.startsWith("/")&&(e=this._apiOrigin+e),a=null,h=i+1,l=0,o.label=6;case 6:if(!(l<h))return[3,13];o.label=7;case 7:return o.trys.push([7,9,,10]),[4,this._baseRequest(e,n)];case 8:return a=o.sent(),[3,13];case 9:return d=o.sent(),l!==i&&d&&"unreachable"===d.error?[3,10]:[2,Promise.reject(d)];case 10:return[4,this._sleep(t._retryInterval)];case 11:o.sent(),o.label=12;case 12:return l++,[3,6];case 13:return[2,a]}}))}))},t.prototype._checkRetry=function(e){var n=null;if(("number"!=typeof e||e<t._minRetry||e>t._maxRetry)&&(n={error:s.ErrorType.UNREACHABLE,error_description:"wrong options param: retry"}),n)throw n;return e},t.prototype._formatRetry=function(t,e){return void 0===t?e:this._checkRetry(t)},t.prototype._sleep=function(t){return i(this,void 0,void 0,(function(){return o(this,(function(e){return[2,new Promise((function(e){setTimeout((function(){e()}),t)}))]}))}))},t.prototype._refreshToken=function(t){return i(this,void 0,void 0,(function(){var e=this;return o(this,(function(n){return[2,this._singlePromise.run("_refreshToken",(function(){return i(e,void 0,void 0,(function(){var e,n;return o(this,(function(r){switch(r.label){case 0:if(!t||!t.refresh_token)return[2,this._unAuthenticatedError("no refresh token found in credentials")];r.label=1;case 1:return r.trys.push([1,4,,7]),[4,this._refreshTokenFunc(t.refresh_token)];case 2:return e=r.sent(),[4,this._localCredentials.setCredentials(e)];case 3:return r.sent(),[2,e];case 4:return(n=r.sent()).error!==s.ErrorType.INVALID_GRANT?[3,6]:[4,this._localCredentials.setCredentials(null)];case 5:return r.sent(),[2,this._unAuthenticatedError(n.error_description)];case 6:return[2,Promise.reject(n)];case 7:return[2]}}))}))}))]}))}))},t.prototype._anonymousSignIn=function(t){return i(this,void 0,void 0,(function(){var e=this;return o(this,(function(n){return[2,this._singlePromise.run("_anonymous",(function(){return i(e,void 0,void 0,(function(){var e,n;return o(this,(function(r){switch(r.label){case 0:if(!t||"anonymous"!==t.scope)return[2,this._unAuthenticatedError("no anonymous in credentials")];r.label=1;case 1:return r.trys.push([1,4,,7]),[4,this.request("/auth/v1/signin/anonymously",{method:"POST",body:{client_id:this._clientId,client_secret:this._clientSecret}})];case 2:return e=r.sent(),[4,this._localCredentials.setCredentials(e)];case 3:return r.sent(),[2,e];case 4:return(n=r.sent()).error!==s.ErrorType.INVALID_GRANT?[3,6]:[4,this._localCredentials.setCredentials(null)];case 5:return r.sent(),[2,this._unAuthenticatedError(n.error_description)];case 6:return[2,Promise.reject(n)];case 7:return[2]}}))}))}))]}))}))},t.prototype._defaultRefreshTokenFunc=function(t){return void 0===t||""===t?this._unAuthenticatedError("refresh token not found"):this.request("/auth/v1/token",{method:"POST",body:{client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token",refresh_token:t}})},t.prototype._getCredentials=function(){return i(this,void 0,void 0,(function(){var t;return o(this,(function(e){switch(e.label){case 0:return[4,this._localCredentials.getCredentials()];case 1:return l(t=e.sent())?t&&"anonymous"===t.scope?[4,this._anonymousSignIn(t)]:[3,3]:[3,5];case 2:return t=e.sent(),[3,5];case 3:return[4,this._refreshToken(t)];case 4:t=e.sent(),e.label=5;case 5:return[2,t]}}))}))},t.prototype.getCredentialsSync=function(){return this._localCredentials._getStorageCredentialsSync()},t.prototype.getCredentialsAsync=function(){return this._localCredentials.getCredentials()},t.prototype._getDeviceId=function(){return i(this,void 0,void 0,(function(){var t;return o(this,(function(e){switch(e.label){case 0:return this._deviceID?[2,this._deviceID]:[4,this._storage.getItem("device_id")];case 1:return"string"==typeof(t=e.sent())&&t.length>=16&&t.length<=48?[3,3]:(t=u.uuidv4(),[4,this._storage.setItem("device_id",t)]);case 2:e.sent(),e.label=3;case 3:return this._deviceID=t,[2,t]}}))}))},t.prototype._unAuthenticatedError=function(t){return Promise.reject({error:s.ErrorType.UNAUTHENTICATED,error_description:t})},t._defaultRetry=2,t._minRetry=0,t._maxRetry=5,t._retryInterval=1e3,t}();e.OAuth2Client=f},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ErrorType=e.Syntax=void 0,function(t){t.CLIENT_ID="client_id",t.CLIENT_SECRET="client_secret",t.RESPONSE_TYPE="response_type",t.SCOPE="scope",t.STATE="state",t.REDIRECT_URI="redirect_uri",t.ERROR="error",t.ERROR_DESCRIPTION="error_description",t.ERROR_URI="error_uri",t.GRANT_TYPE="grant_type",t.CODE="code",t.ACCESS_TOKEN="access_token",t.TOKEN_TYPE="token_type",t.EXPIRES_IN="expires_in",t.USERNAME="username",t.PASSWORD="password",t.REFRESH_TOKEN="refresh_token"}(e.Syntax||(e.Syntax={})),function(t){t.UNREACHABLE="unreachable",t.LOCAL="local",t.CANCELLED="cancelled",t.UNKNOWN="unknown",t.INVALID_ARGUMENT="invalid_argument",t.DEADLINE_EXCEEDED="deadline_exceeded",t.NOT_FOUND="not_found",t.ALREADY_EXISTS="already_exists",t.PERMISSION_DENIED="permission_denied",t.UNAUTHENTICATED="unauthenticated",t.RESOURCE_EXHAUSTED="resource_exhausted",t.FAILED_PRECONDITION="failed_precondition",t.ABORTED="aborted",t.OUT_OF_RANGE="out_of_range",t.UNIMPLEMENTED="unimplemented",t.INTERNAL="internal",t.UNAVAILABLE="unavailable",t.DATA_LOSS="data_loss",t.CAPTCHA_REQUIRED="captcha_required",t.CAPTCHA_INVALID="captcha_invalid",t.INVALID_PASSWORD="invalid_password",t.INVALID_STATUS="invalid_status",t.USER_PENDING="user_pending",t.USER_BLOCKED="user_blocked",t.INVALID_VERIFICATION_CODE="invalid_verification_code",t.TWO_FACTOR_REQUIRED="two_factor_required",t.INVALID_TWO_FACTOR="invalid_two_factor",t.INVALID_TWO_FACTOR_RECOVERY="invalid_two_factor_recovery",t.UNDER_REVIEW="under_review",t.INVALID_REQUEST="invalid_request",t.UNAUTHORIZED_CLIENT="unauthorized_client",t.ACCESS_DENIED="access_denied",t.UNSUPPORTED_RESPONSE_TYPE="unsupported_response_type",t.INVALID_SCOPE="invalid_scope",t.INVALID_GRANT="invalid_grant",t.SERVER_ERROR="server_error",t.TEMPORARILY_UNAVAILABLE="temporarily_unavailable",t.INTERACTION_REQUIRED="interaction_required",t.LOGIN_REQUIRED="login_required",t.ACCOUNT_SELECTION_REQUIRED="account_selection_required",t.CONSENT_REQUIRED="consent_required",t.INVALID_REQUEST_URI="invalid_request_uri",t.INVALID_REQUEST_OBJECT="invalid_request_object",t.REQUEST_NOT_SUPPORTED="request_not_supported",t.REQUEST_URI_NOT_SUPPORTED="request_uri_not_supported",t.REGISTRATION_NOT_SUPPORTED="registration_not_supported"}(e.ErrorType||(e.ErrorType={}))},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{a(r.next(t))}catch(t){o(t)}}function u(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}a((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Auth=void 0;var o=n(9),s=n(0),u=n(10),a=function(){function t(t){var e=t.request,n=t.credentialsClient;if(!n){var r={apiOrigin:t.apiOrigin,clientId:t.clientId,storage:t.storage};n=new s.OAuth2Client(r)}if(!e){var i=n.request.bind(n),o=new u.Captcha({clientId:t.clientId,request:i,storage:t.storage});e=o.request.bind(o)}this._config={apiOrigin:t.apiOrigin,clientId:t.clientId,request:e,credentialsClient:n,storage:t.storage||s.defaultStorage}}return t.prototype.signIn=function(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return t.client_id=this._config.clientId,[4,this._config.request(o.ApiUrls.AUTH_SIGN_IN_URL,{method:"POST",body:t})];case 1:return e=n.sent(),[4,this._config.credentialsClient.setCredentials(e)];case 2:return n.sent(),[2,Promise.resolve(e)]}}))}))},t.prototype.signInAnonymously=function(){return r(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return[4,this._config.request(o.ApiUrls.AUTH_SIGN_IN_ANONYMOUSLY_URL,{method:"POST",body:{client_id:this._config.clientId}})];case 1:return t=e.sent(),[4,this._config.credentialsClient.setCredentials(t)];case 2:return e.sent(),[2,Promise.resolve(t)]}}))}))},t.prototype.signUp=function(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return t.client_id=this._config.clientId,[4,this._config.request(o.ApiUrls.AUTH_SIGN_UP_URL,{method:"POST",body:t})];case 1:return e=n.sent(),[4,this._config.credentialsClient.setCredentials(e)];case 2:return n.sent(),[2,Promise.resolve(e)]}}))}))},t.prototype.signOut=function(){return r(this,void 0,void 0,(function(){var t,e;return i(this,(function(n){switch(n.label){case 0:return[4,this._config.credentialsClient.getAccessToken()];case 1:return t=n.sent(),[4,this._config.request(o.ApiUrls.AUTH_REVOKE_URL,{method:"POST",body:{client_id:this._config.clientId,token:t}})];case 2:return e=n.sent(),[4,this._config.credentialsClient.setCredentials()];case 3:return n.sent(),[2,Promise.resolve(e)]}}))}))},t.prototype.getVerification=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return t.client_id=this._config.clientId,[2,this._config.request(o.ApiUrls.VERIFICATION_URL,{method:"POST",body:t,withCaptcha:!0})]}))}))},t.prototype.verify=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return t.client_id=this._config.clientId,[2,this._config.request(o.ApiUrls.VERIFY_URL,{method:"POST",body:t})]}))}))},t.prototype.genProviderRedirectUri=function(t){return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){return e=o.ApiUrls.PROVIDER_URI_URL+"?client_id="+this._config.clientId+"&provider_id="+t.provider_id+"&redirect_uri="+encodeURIComponent(t.provider_redirect_uri)+"&state="+t.state,(n=t.other_params)&&"string"==typeof n.sign_out_uri&&n.sign_out_uri.length>0&&(e+="&other_params[sign_out_uri]="+n.sign_out_uri),[2,this._config.request(e,{method:"GET"})]}))}))},t.prototype.grantProviderToken=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return t.client_id=this._config.clientId,[2,this._config.request(o.ApiUrls.PROVIDER_TOKEN_URL,{method:"POST",body:t})]}))}))},t.prototype.patchProviderToken=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return t.client_id=this._config.clientId,[2,this._config.request(o.ApiUrls.PROVIDER_TOKEN_URL,{method:"PATCH",body:t})]}))}))},t.prototype.signInWithProvider=function(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return t.client_id=this._config.clientId,[4,this._config.request(o.ApiUrls.AUTH_SIGN_IN_WITH_PROVIDER_URL,{method:"POST",body:t})];case 1:return e=n.sent(),[4,this._config.credentialsClient.setCredentials(e)];case 2:return n.sent(),[2,Promise.resolve(e)]}}))}))},t.prototype.bindWithProvider=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return t.client_id=this._config.clientId,[2,this._config.request(o.ApiUrls.PROVIDER_BIND_URL,{method:"POST",body:t,withCredentials:!0})]}))}))},t.prototype.getUserProfile=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){return[2,this.getUserInfo()]}))}))},t.prototype.getUserInfo=function(){return r(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return[4,this._config.request(o.ApiUrls.USER_ME_URL,{method:"GET",withCredentials:!0})];case 1:return(t=e.sent()).picture&&(t.avatarUrl=t.picture),t.sub&&(t.uid=t.sub),t.name&&(t.username=t.name),[2,t]}}))}))},t.prototype.hasLoginState=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._config.credentialsClient.getAccessToken()];case 1:return t.sent(),[2,!0];case 2:return t.sent(),[2,!1];case 3:return[2]}}))}))},t.prototype.hasLoginStateSync=function(){return this._config.credentialsClient.getCredentialsSync()},t.prototype.getLoginState=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){return[2,this._config.credentialsClient.getCredentialsAsync()]}))}))},t.prototype.transByProvider=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return[2,this._config.request(o.ApiUrls.USER_TRANS_BY_PROVIDER_URL,{method:"PATCH",body:t,withCredentials:!0})]}))}))},t.prototype.grantToken=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return t.client_id=this._config.clientId,[2,this._config.request(o.ApiUrls.AUTH_TOKEN_URL,{method:"POST",body:t})]}))}))},t.prototype.getProviders=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){return[2,this._config.request(o.ApiUrls.PROVIDER_LIST,{method:"GET",withCredentials:!0})]}))}))},t.prototype.unbindProvider=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return t.client_id=this._config.clientId,[2,this._config.request(o.ApiUrls.PROVIDER_UNBIND_URL+"/"+t.provider_id,{method:"DELETE",withCredentials:!0})]}))}))},t.prototype.checkPassword=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return[2,this._config.request(""+o.ApiUrls.CHECK_PWD_URL,{method:"POST",withCredentials:!0,body:t})]}))}))},t.prototype.bindPhone=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return[2,this._config.request(""+o.ApiUrls.BIND_CONTACT_URL,{method:"PATCH",withCredentials:!0,body:t})]}))}))},t.prototype.bindEmail=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return[2,this._config.request(""+o.ApiUrls.BIND_CONTACT_URL,{method:"PATCH",withCredentials:!0,body:t})]}))}))},t.prototype.setPassword=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return[2,this._config.request(""+o.ApiUrls.AUTH_SET_PASSWORD,{method:"PATCH",withCredentials:!0,body:t})]}))}))},t.prototype.updatePasswordByOld=function(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return[4,this.sudo({password:t.old_password})];case 1:return e=n.sent(),[2,this.setPassword({sudo_token:e.sudo_token,new_password:t.new_password})]}}))}))},t.prototype.sudo=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return[2,this._config.request(""+o.ApiUrls.SUDO_URL,{method:"POST",withCredentials:!0,body:t})]}))}))},t.prototype.getCurUserVerification=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return t.client_id=this._config.clientId,t.target="CUR_USER",[2,this._config.request(o.ApiUrls.VERIFICATION_URL,{method:"POST",body:t,withCredentials:!0,withCaptcha:!0})]}))}))},t.prototype.changeBindedProvider=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return t.client_id=this._config.clientId,[2,this._config.request(o.ApiUrls.PROVIDER_LIST+"/"+t.provider_id+"/trans",{method:"POST",body:{provider_trans_token:t.trans_token},withCredentials:!0})]}))}))},t.prototype.setUserProfile=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return[2,this._config.request(o.ApiUrls.USER_PRIFILE_URL,{method:"PATCH",body:t,withCredentials:!0})]}))}))},t.prototype.queryUserProfile=function(t){return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){return e=new URL(o.ApiUrls.USER_QUERY_URL),n=new URLSearchParams(t),e.search=n.toString(),[2,this._config.request(e.toString(),{method:"GET",withCredentials:!0})]}))}))},t.prototype.setCustomSignFunc=function(t){this._getCustomSignTicketFn=t},t.prototype.signInWithCustomTicket=function(){return r(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return[4,this._getCustomSignTicketFn()];case 1:return t=e.sent(),[2,this.signInWithProvider({provider_id:"custom",provider_token:t})]}}))}))},t.prototype.resetPassword=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return t.client_id=this._config.clientId,[2,this._config.request(o.ApiUrls.AUTH_SET_PASSWORD,{method:"POST",body:t,withCredentials:!0})]}))}))},t.prototype.deviceAuthorize=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return t.client_id=this._config.clientId,[2,this._config.request(o.ApiUrls.AUTH_GET_DEVICE_CODE,{method:"POST",body:t,withCredentials:!0})]}))}))},t}();e.Auth=a},function(t,e,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.hasOwnProperty.call(t,n)&&i(e,t,n);return o(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.CloudbaseOAuth=e.authModels=void 0;var u=n(1);Object.defineProperty(e,"Syntax",{enumerable:!0,get:function(){return u.Syntax}}),Object.defineProperty(e,"ErrorType",{enumerable:!0,get:function(){return u.ErrorType}});var a=n(0),c=n(0);Object.defineProperty(e,"defaultStorage",{enumerable:!0,get:function(){return c.defaultStorage}}),Object.defineProperty(e,"defaultRequest",{enumerable:!0,get:function(){return c.defaultRequest}}),Object.defineProperty(e,"toResponseError",{enumerable:!0,get:function(){return c.toResponseError}}),Object.defineProperty(e,"generateRequestId",{enumerable:!0,get:function(){return c.generateRequestId}}),Object.defineProperty(e,"OAuth2Client",{enumerable:!0,get:function(){return c.OAuth2Client}});var h=n(8);Object.defineProperty(e,"AuthClient",{enumerable:!0,get:function(){return h.AuthClient}});var l=n(2),d=n(2);Object.defineProperty(e,"Auth",{enumerable:!0,get:function(){return d.Auth}});var f=s(n(11));e.authModels=f;var _=function(t){var e=t.apiOrigin,n=t.clientId;this.oauth2client=new a.OAuth2Client({apiOrigin:e,clientId:n}),this.authApi=new l.Auth(r({credentialsClient:this.oauth2client},t))};e.CloudbaseOAuth=_},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.registerAuth=void 0;var r=n(5);e.registerAuth=r.registerAuth},function(t,e,n){"use strict";n.r(e),n.d(e,"LoginState",(function(){return u})),n.d(e,"Auth",(function(){return a})),n.d(e,"registerAuth",(function(){return h}));var r=n(3),i=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{a(r.next(t))}catch(t){o(t)}}function u(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}a((r=r.apply(t,e||[])).next())}))},o=function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}},s=function(){function t(t){var e=t.cache,n=t.oauthInstance;this._cache=e,this._oauthInstance=n,this._setUserInfo()}return t.prototype.checkLocalInfo=function(){return i(this,void 0,void 0,(function(){return o(this,(function(t){return this.uid=this._getLocalUserInfo("uid"),this.gender=this._getLocalUserInfo("gender"),this.picture=this._getLocalUserInfo("picture"),this.avatarUrl=this._getLocalUserInfo("avatarUrl"),this.email=this._getLocalUserInfo("email"),this.email_verified=this._getLocalUserInfo("email_verified"),this.phone_number=this._getLocalUserInfo("phone_number"),this.username=this._getLocalUserInfo("username"),this.name=this._getLocalUserInfo("name"),this.birthdate=this._getLocalUserInfo("birthdate"),this.zoneinfo=this._getLocalUserInfo("zoneinfo"),this.locale=this._getLocalUserInfo("locale"),this.sub=this._getLocalUserInfo("sub"),this.created_from=this._getLocalUserInfo("created_from"),this.providers=this._getLocalUserInfo("providers"),[2]}))}))},t.prototype.checkLocalInfoAsync=function(){return i(this,void 0,void 0,(function(){var t,e,n,r,i;return o(this,(function(o){switch(o.label){case 0:return t=this,[4,this._getLocalUserInfoAsync("uid")];case 1:return t.uid=o.sent(),e=this,[4,this._getLocalUserInfoAsync("gender")];case 2:return e.gender=o.sent(),this.picture=this._getLocalUserInfo("picture"),n=this,[4,this._getLocalUserInfoAsync("avatarUrl")];case 3:return n.avatarUrl=o.sent(),r=this,[4,this._getLocalUserInfoAsync("email")];case 4:return r.email=o.sent(),this.email_verified=this._getLocalUserInfo("email_verified"),this.phone_number=this._getLocalUserInfo("phone_number"),i=this,[4,this._getLocalUserInfoAsync("username")];case 5:return i.username=o.sent(),this.name=this._getLocalUserInfo("name"),this.birthdate=this._getLocalUserInfo("birthdate"),this.zoneinfo=this._getLocalUserInfo("zoneinfo"),this.locale=this._getLocalUserInfo("locale"),this.sub=this._getLocalUserInfo("sub"),this.created_from=this._getLocalUserInfo("created_from"),this.providers=this._getLocalUserInfo("providers"),[2]}}))}))},t.prototype.update=function(t){return i(this,void 0,void 0,(function(){var e,n,r,i,s,u,a;return o(this,(function(o){switch(o.label){case 0:return e=t.name,n=t.gender,r=t.avatarUrl,i=t.province,s=t.country,u=t.city,[4,this._oauthInstance.authApi.setUserProfile({name:e,gender:n,avatarUrl:r,province:i,country:s,city:u})];case 1:return a=o.sent(),this._setLocalUserInfo(a),[2]}}))}))},t.prototype.updatePassword=function(t,e){return this._oauthInstance.authApi.updatePasswordByOld({old_password:e,new_password:t})},t.prototype.updateUsername=function(t){return this.update({username:t})},t.prototype.refresh=function(){return i(this,void 0,void 0,(function(){var t;return o(this,(function(e){switch(e.label){case 0:return[4,this._oauthInstance.authApi.getUserInfo()];case 1:return t=e.sent(),this._setLocalUserInfo(t),[2,t]}}))}))},t.prototype._getLocalUserInfo=function(t){var e=this._cache.keys.userInfoKey;return this._cache.getStore(e)[t]},t.prototype._getLocalUserInfoAsync=function(t){return i(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return e=this._cache.keys.userInfoKey,[4,this._cache.getStoreAsync(e)];case 1:return[2,n.sent()[t]]}}))}))},t.prototype._setUserInfo=function(){var t=this,e=this._cache.keys.userInfoKey,n=this._cache.getStore(e);["uid","email","name","gender","picture","avatarUrl","phone","email_verified","phone_number","birthdate","zoneinfo","locale","sub","created_from","providers","username"].forEach((function(e){t[e]=n[e]}))},t.prototype._setLocalUserInfo=function(t){var e=this._cache.keys.userInfoKey;this._cache.setStore(e,t),this._setUserInfo()},t}(),u=function(){function t(t){t.envId;var e=t.cache,n=t.oauthInstance;this._cache=e,this._oauthInstance=n,this.user=new s({cache:this._cache,oauthInstance:n})}return t.prototype.checkLocalState=function(){var t;this.oauthLoginState=null===(t=this._oauthInstance)||void 0===t?void 0:t.authApi.hasLoginStateSync(),this.user.checkLocalInfo()},t.prototype.checkLocalStateAsync=function(){var t;return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,null===(t=this._oauthInstance)||void 0===t?void 0:t.authApi.getLoginState()];case 1:return e.sent(),[4,this.user.checkLocalInfoAsync()];case 2:return e.sent(),[2]}}))}))},t}(),a=function(){function t(t){this._config=t,this._cache=t.cache,this._oauthInstance=t.oauthInstance}return t.prototype.bindPhoneNumber=function(t){return i(this,void 0,void 0,(function(){return o(this,(function(e){return[2,this._oauthInstance.authApi.bindPhone(t)]}))}))},t.prototype.unbindProvider=function(t){return i(this,void 0,void 0,(function(){return o(this,(function(e){return[2,this._oauthInstance.authApi.unbindProvider(t)]}))}))},t.prototype.bindEmail=function(t){return this._oauthInstance.authApi.bindEmail(t)},t.prototype.verify=function(t){return i(this,void 0,void 0,(function(){return o(this,(function(e){return[2,this._oauthInstance.authApi.verify(t)]}))}))},t.prototype.getVerification=function(t){return i(this,void 0,void 0,(function(){return o(this,(function(e){return[2,this._oauthInstance.authApi.getVerification(t)]}))}))},Object.defineProperty(t.prototype,"currentUser",{get:function(){if("async"!==this._cache.mode){var t=this.hasLoginState();return t&&t.user||null}},enumerable:!1,configurable:!0}),t.prototype.getCurrentUser=function(){return i(this,void 0,void 0,(function(){var t;return o(this,(function(e){switch(e.label){case 0:return[4,this.getLoginState()];case 1:return(t=e.sent())?[4,t.user.checkLocalInfoAsync()]:[3,3];case 2:return e.sent(),[2,t.user||null];case 3:return[2,null]}}))}))},t.prototype.signInAnonymously=function(){return i(this,void 0,void 0,(function(){var t;return o(this,(function(e){switch(e.label){case 0:return[4,this._oauthInstance.authApi.signInAnonymously()];case 1:return e.sent(),[4,(t=new u({envId:this._config.env,cache:this._cache,oauthInstance:this._oauthInstance})).checkLocalStateAsync()];case 2:return e.sent(),[4,t.user.refresh()];case 3:return e.sent(),[2,t]}}))}))},t.prototype.setCustomSignFunc=function(t){this._oauthInstance.authApi.setCustomSignFunc(t)},t.prototype.signInWithCustomTicket=function(){return i(this,void 0,void 0,(function(){var t;return o(this,(function(e){switch(e.label){case 0:return[4,this._oauthInstance.authApi.signInWithCustomTicket()];case 1:return e.sent(),[4,(t=new u({envId:this._config.env,cache:this._cache,oauthInstance:this._oauthInstance})).checkLocalStateAsync()];case 2:return e.sent(),[4,t.user.refresh()];case 3:return e.sent(),[2,t]}}))}))},t.prototype.signIn=function(t){return i(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return[4,this._oauthInstance.authApi.signIn(t)];case 1:return n.sent(),[4,(e=new u({envId:this._config.env,cache:this._cache,oauthInstance:this._oauthInstance})).checkLocalStateAsync()];case 2:return n.sent(),[4,e.user.refresh()];case 3:return n.sent(),[2,e]}}))}))},t.prototype.signUp=function(t){return i(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return[4,this._oauthInstance.authApi.signUp(t)];case 1:return n.sent(),[4,(e=new u({envId:this._config.env,cache:this._cache,oauthInstance:this._oauthInstance})).checkLocalStateAsync()];case 2:return n.sent(),[4,e.user.refresh()];case 3:return n.sent(),[2,e]}}))}))},t.prototype.setPassword=function(t){return i(this,void 0,void 0,(function(){return o(this,(function(e){return[2,this._oauthInstance.authApi.setPassword(t)]}))}))},t.prototype.isUsernameRegistered=function(t){return i(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return[4,this.queryUser({username:t})];case 1:return e=n.sent(),[2,!!parseInt(e.total)]}}))}))},t.prototype.signOut=function(){return i(this,void 0,void 0,(function(){var t;return o(this,(function(e){switch(e.label){case 0:return t=this._cache.keys.userInfoKey,[4,this._oauthInstance.authApi.signOut()];case 1:return e.sent(),[4,this._cache.removeStoreAsync(t)];case 2:return e.sent(),[2]}}))}))},t.prototype.hasLoginState=function(){var t;if("async"!==this._cache.mode)return(null===(t=this._oauthInstance)||void 0===t?void 0:t.authApi.hasLoginStateSync())?new u({envId:this._config.env,cache:this._cache,oauthInstance:this._oauthInstance}):null},t.prototype.getLoginState=function(){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this._oauthInstance.authApi.getLoginState()];case 1:return t.sent()?[2,new u({envId:this._config.env,cache:this._cache,oauthInstance:this._oauthInstance})]:[2,null]}}))}))},t.prototype.getUserInfo=function(){return i(this,void 0,void 0,(function(){return o(this,(function(t){return[2,this._oauthInstance.authApi.getUserInfo()]}))}))},t.prototype.bindWithProvider=function(t){return i(this,void 0,void 0,(function(){return o(this,(function(e){return[2,this._oauthInstance.authApi.bindWithProvider(t)]}))}))},t.prototype.queryUser=function(t){return i(this,void 0,void 0,(function(){return o(this,(function(e){return[2,this._oauthInstance.authApi.queryUserProfile(t)]}))}))},t.prototype.getAccessToken=function(){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this._oauthInstance.oauth2client.getAccessToken()];case 1:return[2,{accessToken:t.sent(),env:this._config.env}]}}))}))},t.prototype.grantProviderToken=function(t){return i(this,void 0,void 0,(function(){return o(this,(function(e){return[2,this._oauthInstance.authApi.grantProviderToken(t)]}))}))},t.prototype.signInWithProvider=function(t){return i(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return[4,this._oauthInstance.authApi.signInWithProvider(t)];case 1:return n.sent(),[4,(e=new u({envId:this._config.env,cache:this._cache,oauthInstance:this._oauthInstance})).checkLocalStateAsync()];case 2:return n.sent(),[4,e.user.refresh()];case 3:return n.sent(),[2,e]}}))}))},t.prototype.grantToken=function(t){return i(this,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return[4,this._oauthInstance.authApi.grantToken(t)];case 1:return n.sent(),[4,(e=new u({envId:this._config.env,cache:this._cache,oauthInstance:this._oauthInstance})).checkLocalStateAsync()];case 2:return n.sent(),[4,e.user.refresh()];case 3:return n.sent(),[2,e]}}))}))},t.prototype.genProviderRedirectUri=function(t){return i(this,void 0,void 0,(function(){return o(this,(function(e){return[2,this._oauthInstance.authApi.genProviderRedirectUri(t)]}))}))},t.prototype.resetPassword=function(t){return i(this,void 0,void 0,(function(){return o(this,(function(e){return[2,this._oauthInstance.authApi.resetPassword(t)]}))}))},t.prototype.deviceAuthorize=function(t){return i(this,void 0,void 0,(function(){return o(this,(function(e){return[2,this._oauthInstance.authApi.deviceAuthorize(t)]}))}))},t}(),c={name:"auth",namespace:"auth",entity:function(t){if(void 0===t&&(t={region:"",persistence:"local"}),this.authInstance)return this.authInstance;var e=this.platform,n=e.adapter,i=e.runtime,o=t.persistence||n.primaryStorage;o&&o!==this.config.persistence&&this.updateConfig({persistence:o});var s=this.config,u=s.env,c=s.persistence,h=s.debug,l=new r.CloudbaseOAuth({clientId:u,apiOrigin:this.request.getBaseEndPoint()});return this.oauthInstance=l,this.authInstance=new a({env:u,region:t.region,persistence:c,debug:h,cache:this.cache,runtime:i,_fromApp:this,oauthInstance:l}),this.authInstance}};try{cloudbase.registerComponent(c)}catch(t){}function h(t){try{t.registerComponent(c)}catch(t){console.warn(t)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.uuidv4=void 0,e.uuidv4=function(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{a(r.next(t))}catch(t){o(t)}}function u(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}a((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.SinglePromise=void 0;var o=function(){function t(){this._fnPromiseMap=new Map}return t.prototype.run=function(t,e){return r(this,void 0,void 0,(function(){var n,o=this;return i(this,(function(s){return(n=this._fnPromiseMap.get(t))||(n=new Promise((function(n,s){return r(o,void 0,void 0,(function(){var r,o,u;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,4,5]),[4,this._runIdlePromise()];case 1:return i.sent(),r=e(),o=n,[4,r];case 2:return o.apply(void 0,[i.sent()]),[3,5];case 3:return u=i.sent(),s(u),[3,5];case 4:return this._fnPromiseMap.delete(t),[7];case 5:return[2]}}))}))})),this._fnPromiseMap.set(t,n)),[2,n]}))}))},t.prototype._runIdlePromise=function(){return Promise.resolve()},t}();e.SinglePromise=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AuthClient=void 0;var r=function(){};e.AuthClient=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ErrorType=e.VerificationUsages=e.ApiUrls=void 0,function(t){t.AUTH_SIGN_IN_URL="/auth/v1/signin",t.AUTH_SIGN_IN_ANONYMOUSLY_URL="/auth/v1/signin/anonymously",t.AUTH_SIGN_IN_WITH_PROVIDER_URL="/auth/v1/signin/with/provider",t.AUTH_SIGN_UP_URL="/auth/v1/signup",t.AUTH_TOKEN_URL="/auth/v1/token",t.AUTH_REVOKE_URL="/auth/v1/revoke",t.PROVIDER_BIND_URL="/auth/v1/user/provider/bind",t.PROVIDER_TOKEN_URL="/auth/v1/provider/token",t.PROVIDER_URI_URL="/auth/v1/provider/uri",t.USER_ME_URL="/auth/v1/user/me",t.USER_QUERY_URL="/auth/v1/user/query",t.USER_PRIFILE_URL="/auth/v1/user/profile",t.USER_TRANS_BY_PROVIDER_URL="/auth/v1/user/trans/by/provider",t.VERIFICATION_URL="/auth/v1/verification",t.VERIFY_URL="/auth/v1/verification/verify",t.PROVIDER_LIST="/auth/v1/user/provider",t.PROVIDER_UNBIND_URL="/auth/v1/user/provider",t.CHECK_PWD_URL="/auth/v1/user/sudo",t.SUDO_URL="/auth/v1/user/sudo",t.BIND_CONTACT_URL="/auth/v1/user/contact",t.AUTH_SET_PASSWORD="/auth/v1/user/password",t.AUTH_RESET_PASSWORD="/auth/v1/reset",t.AUTH_GET_DEVICE_CODE="/auth/v1/device/code"}(e.ApiUrls||(e.ApiUrls={})),function(t){t.REGISTER="REGISTER",t.SIGN_IN="SIGN_IN",t.PASSWORD_RESET="PASSWORD_RESET",t.EMAIL_ADDRESS_CHANGE="EMAIL_ADDRESS_CHANGE",t.PHONE_NUMBER_CHANGE="PHONE_NUMBER_CHANGE"}(e.VerificationUsages||(e.VerificationUsages={})),function(t){t.INVALID_ARGUMENT="invalid_argument",t.DEADLINE_EXCEEDED="deadline_exceeded",t.NOT_FOUND="not_found",t.ALREADY_EXISTS="already_exists",t.PERMISSION_DENIED="permission_denied",t.ABORTED="aborted",t.OUT_OF_RANGE="out_of_range",t.UNIMPLEMENTED="unimplemented",t.INTERNAL="internal",t.UNAVAILABLE="unavailable",t.DATA_LOSS="data_loss",t.CAPTCHA_REQUIRED="captcha_required",t.CAPTCHA_INVALID="captcha_invalid",t.INVALID_PASSWORD="invalid_password",t.PASSWORD_NOT_SET="password_not_set",t.INVALID_STATUS="invalid_status",t.USER_PENDING="user_pending",t.USER_BLOCKED="user_blocked"}(e.ErrorType||(e.ErrorType={}))},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{a(r.next(t))}catch(t){o(t)}}function u(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}a((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Captcha=void 0;var o=n(0),s=function(){function t(t){t.openURIWithCallback||(t.openURIWithCallback=this._getDefaultOpenURIWithCallback()),t.storage||(t.storage=o.defaultStorage),this._config=t,this._tokenSectionName="captcha_"+t.clientId}return t.prototype.request=function(t,e){return r(this,void 0,void 0,(function(){var n,r,o;return i(this,(function(i){switch(i.label){case 0:return e||(e={}),e.method||(e.method="GET"),n=e.method+":"+t,r=t,e.withCaptcha?[4,this._appendCaptchaTokenToURL(t,n,!1)]:[3,2];case 1:r=i.sent(),i.label=2;case 2:return i.trys.push([2,3,,7]),[2,this._config.request(r,e)];case 3:return"captcha_required"!==(o=i.sent()).error&&"captcha_invalid"!==o.error?[3,5]:[4,this._appendCaptchaTokenToURL(t,n,"captcha_invalid"===o.error)];case 4:return t=i.sent(),[2,this._config.request(t,e)];case 5:return[2,Promise.reject(o)];case 6:return[3,7];case 7:return[2]}}))}))},t.prototype._getDefaultOpenURIWithCallback=function(){if(window.location.search.indexOf("__captcha")>0&&(document.body.style.display="none"),null===document.getElementById("captcha_panel_wrap")){var t=document.createElement("div");t.style.cssText="background-color: rgba(0, 0, 0, 0.7);position: fixed;left: 0px;right: 0px;top: 0px;bottom: 0px;padding: 9vw 0 0 0;display: none;z-index:100;",t.setAttribute("id","captcha_panel_wrap"),document.body.appendChild(t)}return this._defaultOpenURIWithCallback},t.prototype._defaultOpenURIWithCallback=function(t){return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){return e=document.getElementById("captcha_panel_wrap"),n=document.createElement("iframe"),e.innerHTML="",n.setAttribute("src",t),n.setAttribute("id","review-panel-iframe"),n.style.cssText="min-width:355px;display:block;height:355px;margin:0 auto;background-color: rgb(255, 255, 255);border: none;",e.appendChild(n),e.style.display="block",[2,new Promise((function(t,r){n.onload=function(){try{var i=window.location,o=n.contentWindow.location;if(o.host+o.pathname===i.host+i.pathname){e.style.display="none";var s=new URLSearchParams(o.search),u=s.get("captcha_token");return u?t({captcha_token:u,expires_in:Number(s.get("expires_in"))}):r({error:s.get("error"),error_description:s.get("error_description")})}e.style.display="block"}catch(t){e.style.display="block"}}}))]}))}))},t.prototype._getCaptchaToken=function(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s,u;return i(this,(function(i){switch(i.label){case 0:return t?[3,2]:[4,this._findCaptchaToken()];case 1:if(n=i.sent())return[2,n];i.label=2;case 2:return r=window.location.origin+window.location.pathname+"?__captcha=on",[4,this._config.request("/auth/v1/captcha/init",{method:"POST",body:{client_id:this._config.clientId,redirect_uri:r,state:e},withCredentials:!1})];case 3:return(o=i.sent()).captcha_token?(s={captcha_token:o.captcha_token,expires_in:o.expires_in},this._saveCaptchaToken(s),[2,o.captcha_token]):[4,this._config.openURIWithCallback(o.url)];case 4:return u=i.sent(),this._saveCaptchaToken(u),[2,u.captcha_token]}}))}))},t.prototype._appendCaptchaTokenToURL=function(t,e,n){return r(this,void 0,void 0,(function(){var r;return i(this,(function(i){switch(i.label){case 0:return[4,this._getCaptchaToken(n,e)];case 1:return r=i.sent(),t.indexOf("?")>0?t+="&captcha_token="+r:t+="?captcha_token="+r,[2,t]}}))}))},t.prototype._saveCaptchaToken=function(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return t.expires_at=new Date(Date.now()+1e3*(t.expires_in-10)),e=JSON.stringify(t),[4,this._config.storage.setItem(this._tokenSectionName,e)];case 1:return n.sent(),[2]}}))}))},t.prototype._findCaptchaToken=function(){return r(this,void 0,void 0,(function(){var t,e;return i(this,(function(n){switch(n.label){case 0:return[4,this._config.storage.getItem(this._tokenSectionName)];case 1:if(null==(t=n.sent()))return[3,5];n.label=2;case 2:return n.trys.push([2,3,,5]),(null==(e=JSON.parse(t))?void 0:e.expires_at)&&(e.expires_at=new Date(e.expires_at)),e.expires_at<new Date?[2,null]:[2,e.captcha_token];case 3:return n.sent(),[4,this._config.storage.removeItem(this._tokenSectionName)];case 4:return n.sent(),[2,null];case 5:return[2,null]}}))}))},t}();e.Captcha=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}])}));