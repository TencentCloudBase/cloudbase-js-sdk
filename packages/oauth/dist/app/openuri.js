"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.defaultOpenURIWithCallback = void 0;
exports.defaultOpenURIWithCallback = function (url, opts) {
    var iframeTag = '__iframe';
    if (window.location.search.indexOf(iframeTag) > 0) {
        document.body.style.display = 'none';
    }
    if (!opts) {
        opts = {
            width: '355px',
            height: '355px'
        };
    }
    if (document.getElementById('_iframe_panel_wrap') === null) {
        var elementDiv = document.createElement('div');
        elementDiv.style.cssText =
            'background-color: rgba(0, 0, 0, 0.7);position: fixed;left: 0px;right: 0px;top: 0px;bottom: 0px;padding: 9vw 0 0 0;display: none;z-index:100;';
        elementDiv.setAttribute('id', '_iframe_panel_wrap');
        document.body.appendChild(elementDiv);
    }
    var target = document.getElementById('_iframe_panel_wrap'), iframe = document.createElement('iframe');
    target.innerHTML = '';
    var openURL = new URL(url);
    var redirectUri = openURL.searchParams.get('redirect_uri');
    if (redirectUri) {
        var redirectUrl = new URL(redirectUri);
        redirectUrl.searchParams.append(iframeTag, "on");
        openURL.searchParams.set('redirect_uri', redirectUrl.href);
        url = openURL.href;
    }
    iframe.setAttribute('src', url);
    iframe.setAttribute('id', '_iframe_panel_wrap_iframe');
    iframe.style.cssText = "min-width:" + opts.width + ";display:block;height:" + opts.height + ";margin:0 auto;background-color: rgb(255, 255, 255);border: none;";
    target.appendChild(iframe);
    target.style.display = 'block';
    var callBack = new Callback();
    window.addEventListener('message', function (e) {
        if (e.origin == openURL.origin && callBack.callFunc) {
            target.style.display = 'none';
            var data = JSON.parse(e.data);
            try {
                callBack.callFunc(data);
            }
            catch (e) {
            }
        }
    }, false);
    return new Promise(function (resolve, reject) {
        callBack.callFunc = function (data) {
            if (data.error) {
                return reject(data);
            }
            return resolve(data);
        };
        iframe.onload = function () {
            try {
                var windowLocation = window.location;
                var iframeLocation = iframe.contentWindow.location;
                if (iframeLocation.host +
                    iframeLocation.pathname ===
                    windowLocation.host +
                        windowLocation.pathname) {
                    target.style.display = 'none';
                    var iframeUrlParams = new URLSearchParams(iframeLocation.search);
                    var data_1 = {};
                    iframeUrlParams.forEach(function (v, k) {
                        data_1[k] = v;
                    });
                    if (data_1.error) {
                        return reject({
                            error: iframeUrlParams.get('error'),
                            error_description: iframeUrlParams.get('error_description')
                        });
                    }
                    return resolve(data_1);
                }
                else {
                    target.style.display = 'block';
                }
            }
            catch (error) {
                target.style.display = 'block';
            }
        };
    });
};
var Callback = (function () {
    function Callback() {
    }
    return Callback;
}());
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3BlbnVyaS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hcHAvb3BlbnVyaS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFtQmEsUUFBQSwwQkFBMEIsR0FBd0IsVUFBQyxHQUFXLEVBQUUsSUFBcUI7SUFDaEcsSUFBSSxTQUFTLEdBQUcsVUFBVSxDQUFDO0lBQzNCLElBQUksTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsRUFBRTtRQUNqRCxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDO0tBQ3RDO0lBQ0QsSUFBSSxDQUFDLElBQUksRUFBRTtRQUNULElBQUksR0FBRztZQUNMLEtBQUssRUFBRSxPQUFPO1lBQ2QsTUFBTSxFQUFFLE9BQU87U0FDaEIsQ0FBQTtLQUNGO0lBQ0QsSUFBSSxRQUFRLENBQUMsY0FBYyxDQUFDLG9CQUFvQixDQUFDLEtBQUssSUFBSSxFQUFFO1FBQzFELElBQUksVUFBVSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDL0MsVUFBVSxDQUFDLEtBQUssQ0FBQyxPQUFPO1lBQ3RCLDhJQUE4SSxDQUFDO1FBQ2pKLFVBQVUsQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLG9CQUFvQixDQUFDLENBQUM7UUFDcEQsUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLENBQUM7S0FDdkM7SUFDRCxJQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLG9CQUFvQixDQUFDLEVBQzFELE1BQU0sR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFBO0lBQzNDLE1BQU0sQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO0lBQ3RCLElBQU0sT0FBTyxHQUFHLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzdCLElBQU0sV0FB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eUJBQzVELENBQUMsQ0FBQTtxQkFDSDtvQkFDRCxPQUFPLE9BQU8sQ0FBQyxNQUFJLENBQUMsQ0FBQTtpQkFDckI7cUJBQU07b0JBQ0wsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO2lCQUNoQzthQUNGO1lBQUMsT0FBTyxLQUFLLEVBQUU7Z0JBQ2QsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO2FBQ2hDO1FBQ0gsQ0FBQyxDQUFDO0lBQ0osQ0FBQyxDQUFDLENBQUE7QUFDSixDQUFDLENBQUE7QUFHRDtJQUFBO0lBRUEsQ0FBQztJQUFELGVBQUM7QUFBRCxDQUFDLEFBRkQsSUFFQyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCB0eXBlIE9wZW5VUklXaXRoQ2FsbGJhY2sgPSAodXJsOiBzdHJpbmcsIG9wdHM/OiBPcGVuVVJJT3B0aW9ucykgPT4gUHJvbWlzZTx7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9PjtcblxuZXhwb3J0IGludGVyZmFjZSBPcGVuVVJJT3B0aW9ucyB7XG4gIHdpZHRoOiBzdHJpbmc7XG4gIGhlaWdodDogc3RyaW5nO1xufVxuXG4vKipcbiAqIGRlZmF1bHQgdXNlIGlmcmFtZSB0byBvcGVuIHVybCBjYW4gcmV0dXJuIGNhbGxiYWNrXG4gKiBmb3IgZXhhbXBsZSA6IG9wZW4gaHR0cHM6Ly9leGFtcGxlLmNvbS9jYWxsYmFjaz9yZWRpcmV0X3VyaT1odHRwOi8vMTI3LjAuMC4xOjgwODAvXG4gKiAgICAgdGhlIGl0IGlzIGRvbmUsIGl0IHdpbGwgY2FsbGJhY2sgaHR0cDovLzEyNy4wLjAuMTo4MDgwLz9kYXRhMT14JmRhdGEyPTNcbiAqXG4gKiBmb3IgZXhhbXBsZSA6IG9wZW4gaHR0cHM6Ly9leGFtcGxlLmNvbS9jYWxsYmFjaz9yZWRpcmV0X3VyaT1odHRwOi8vMTI3LjAuMC4xOjgwODAvP19faWZyYW1lPT1vblxuICogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgY29uc29sZS5sb2coZSlcbiAgICAgICAgYWxlcnQoJ2RhdGEgZnJvbSBkb21haW4yIC0tLT4gJyArIGUuZGF0YSk7XG4gICAgfSwgZmFsc2UpO1xuICpcbiAqL1xuZXhwb3J0IGNvbnN0IGRlZmF1bHRPcGVuVVJJV2l0aENhbGxiYWNrOiBPcGVuVVJJV2l0aENhbGxiYWNrID0gKHVybDogc3RyaW5nLCBvcHRzPzogT3BlblVSSU9wdGlvbnMpOiBQcm9taXNlPHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0+ID0+IHtcbiAgbGV0IGlmcmFtZVRhZyA9ICdfX2lmcmFtZSc7XG4gIGlmICh3aW5kb3cubG9jYXRpb24uc2VhcmNoLmluZGV4T2YoaWZyYW1lVGFnKSA+IDApIHtcbiAgICBkb2N1bWVudC5ib2R5LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gIH1cbiAgaWYgKCFvcHRzKSB7XG4gICAgb3B0cyA9IHtcbiAgICAgIHdpZHRoOiAnMzU1cHgnLFxuICAgICAgaGVpZ2h0OiAnMzU1cHgnXG4gICAgfVxuICB9XG4gIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnX2lmcmFtZV9wYW5lbF93cmFwJykgPT09IG51bGwpIHtcbiAgICB2YXIgZWxlbWVudERpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGVsZW1lbnREaXYuc3R5bGUuY3NzVGV4dCA9XG4gICAgICAnYmFja2dyb3VuZC1jb2xvcjogcmdiYSgwLCAwLCAwLCAwLjcpO3Bvc2l0aW9uOiBmaXhlZDtsZWZ0OiAwcHg7cmlnaHQ6IDBweDt0b3A6IDBweDtib3R0b206IDBweDtwYWRkaW5nOiA5dncgMCAwIDA7ZGlzcGxheTogbm9uZTt6LWluZGV4OjEwMDsnO1xuICAgIGVsZW1lbnREaXYuc2V0QXR0cmlidXRlKCdpZCcsICdfaWZyYW1lX3BhbmVsX3dyYXAnKTtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsZW1lbnREaXYpO1xuICB9XG4gIGNvbnN0IHRhcmdldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdfaWZyYW1lX3BhbmVsX3dyYXAnKSxcbiAgICBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpZnJhbWUnKVxuICB0YXJnZXQuaW5uZXJIVE1MID0gJyc7XG4gIGNvbnN0IG9wZW5VUkwgPSBuZXcgVVJMKHVybCk7XG4gIGNvbnN0IHJlZGlyZWN0VXJpID0gb3BlblVSTC5zZWFyY2hQYXJhbXMuZ2V0KCdyZWRpcmVjdF91cmknKVxuICBpZiAocmVkaXJlY3RVcmkpIHtcbiAgICBjb25zdCByZWRpcmVjdFVybCA9IG5ldyBVUkwocmVkaXJlY3RVcmkpO1xuICAgIHJlZGlyZWN0VXJsLnNlYXJjaFBhcmFtcy5hcHBlbmQoaWZyYW1lVGFnLCBcIm9uXCIpXG4gICAgb3BlblVSTC5zZWFyY2hQYXJhbXMuc2V0KCdyZWRpcmVjdF91cmknLCByZWRpcmVjdFVybC5ocmVmKVxuICAgIHVybCA9IG9wZW5VUkwuaHJlZlxuICB9XG4gIGlmcmFtZS5zZXRBdHRyaWJ1dGUoJ3NyYycsIHVybClcbiAgaWZyYW1lLnNldEF0dHJpYnV0ZSgnaWQnLCAnX2lmcmFtZV9wYW5lbF93cmFwX2lmcmFtZScpXG4gIGlmcmFtZS5zdHlsZS5jc3NUZXh0ID0gYG1pbi13aWR0aDoke29wdHMud2lkdGh9O2Rpc3BsYXk6YmxvY2s7aGVpZ2h0OiR7b3B0cy5oZWlnaHR9O21hcmdpbjowIGF1dG87YmFja2dyb3VuZC1jb2xvcjogcmdiKDI1NSwgMjU1LCAyNTUpO2JvcmRlcjogbm9uZTtgO1xuICB0YXJnZXQuYXBwZW5kQ2hpbGQoaWZyYW1lKTtcbiAgdGFyZ2V0LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuXG4gIGxldCBjYWxsQmFjayA9IG5ldyBDYWxsYmFjaygpXG4gIC8vIGhhbmRsZSBjYWxsYmFjayBmcm9tIGlmcmFtZSBwb3N0IG1lc3NhZ2VcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBlID0+IHtcbiAgICBpZiAoZS5vcmlnaW4gPT0gb3BlblVSTC5vcmlnaW4gJiYgY2FsbEJhY2suY2FsbEZ1bmMpIHtcbiAgICAgIHRhcmdldC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgY29uc3QgZGF0YSA9IEpTT04ucGFyc2UoZS5kYXRhKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNhbGxCYWNrLmNhbGxGdW5jKGRhdGEpXG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICB9XG4gICAgfVxuICB9LCBmYWxzZSk7XG4gIHJldHVybiBuZXcgUHJvbWlzZTx7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9PigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgY2FsbEJhY2suY2FsbEZ1bmMgPSBkYXRhID0+IHtcbiAgICAgIGlmIChkYXRhLmVycm9yKSB7XG4gICAgICAgIHJldHVybiByZWplY3QoZGF0YSlcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXNvbHZlKGRhdGEpXG4gICAgfVxuICAgIC8vIGhhbmRsZSBjYWxsYmFjayBmcm9tIGlmcmFtZSByZWRpcmVjdCB1cmlcbiAgICBpZnJhbWUub25sb2FkID0gKCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgdmFyIHdpbmRvd0xvY2F0aW9uID0gd2luZG93LmxvY2F0aW9uO1xuICAgICAgICB2YXIgaWZyYW1lTG9jYXRpb24gPSBpZnJhbWUuY29udGVudFdpbmRvdy5sb2NhdGlvbjtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIGlmcmFtZUxvY2F0aW9uLmhvc3QgK1xuICAgICAgICAgIGlmcmFtZUxvY2F0aW9uLnBhdGhuYW1lID09PVxuICAgICAgICAgIHdpbmRvd0xvY2F0aW9uLmhvc3QgK1xuICAgICAgICAgIHdpbmRvd0xvY2F0aW9uLnBhdGhuYW1lXG4gICAgICAgICkge1xuICAgICAgICAgIHRhcmdldC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICAgIGNvbnN0IGlmcmFtZVVybFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoaWZyYW1lTG9jYXRpb24uc2VhcmNoKTtcbiAgICAgICAgICBjb25zdCBkYXRhOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9ID0ge307XG4gICAgICAgICAgaWZyYW1lVXJsUGFyYW1zLmZvckVhY2goKHYsIGspID0+IHtcbiAgICAgICAgICAgIGRhdGFba10gPSB2O1xuICAgICAgICAgIH0pXG4gICAgICAgICAgaWYgKGRhdGEuZXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiByZWplY3Qoe1xuICAgICAgICAgICAgICBlcnJvcjogaWZyYW1lVXJsUGFyYW1zLmdldCgnZXJyb3InKSxcbiAgICAgICAgICAgICAgZXJyb3JfZGVzY3JpcHRpb246IGlmcmFtZVVybFBhcmFtcy5nZXQoJ2Vycm9yX2Rlc2NyaXB0aW9uJylcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiByZXNvbHZlKGRhdGEpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGFyZ2V0LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICB0YXJnZXQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICB9XG4gICAgfTtcbiAgfSlcbn1cblxuXG5jbGFzcyBDYWxsYmFjayB7XG4gIHB1YmxpYyBjYWxsRnVuYzogKGRhdGE/OiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9KSA9PiB2b2lkO1xufSJdfQ==